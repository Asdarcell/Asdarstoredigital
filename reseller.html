<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade Akun Reseller</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div>
        <h1>Pilih Paket Reseller Anda</h1>
        <p>Anda sudah login. Silakan pilih paket untuk melanjutkan proses upgrade.</p>
        <button id="pilih-paket-a">Pilih Paket A (Rp 100.000)</button>
        <button id="pilih-paket-b">Pilih Paket B (Rp 50.000)</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSy...", // GANTI DENGAN KUNCI API ANDA
            authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
            projectId: "asdarstoredigitalll-d89c4",
            // ...sisa config Anda
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        function handlePackageSelection(paketPilihan) {
            // Langsung ambil pengguna yang sedang aktif
            const user = auth.currentUser;

            // Jika karena alasan tertentu user tidak ditemukan, arahkan ke login
            if (!user) {
                alert("Sesi Anda tidak ditemukan. Harap login kembali.");
                window.location.replace('index.html');
                return;
            }

            // Lanjutkan proses jika user ditemukan
            const namaPaket = `Paket ${paketPilihan}`;
            if (confirm(`Anda akan memilih ${namaPaket}. Lanjutkan ke pembayaran?`)) {
                const userDocRef = db.collection('users').doc(user.uid);
                userDocRef.update({
                    status_reseller: 'menunggu_pembayaran',
                    paket_dipilih: paketPilihan
                })
                .then(() => {
                    // Arahkan ke halaman deposit dengan info paket
                    window.location.href = 'deposit.html?paket=' + paketPilihan;
                })
                .catch(error => {
                    console.error("Gagal update status:", error);
                    alert("Terjadi kesalahan. Silakan coba lagi.");
                });
            }
        }

        // Pasang event listener ke tombol
        document.getElementById('pilih-paket-a').addEventListener('click', () => handlePackageSelection('A'));
        document.getElementById('pilih-paket-b').addEventListener('click', () => handlePackageSelection('B'));
    </script>
</body>
</html>
