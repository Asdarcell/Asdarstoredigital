<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilihan Reseller - Asdar Store Digital</title>
    <link rel="icon" href="favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ... (CSS Anda tetap sama) ... */
        :root { --bg: #f9f9f9; --text: #2c3e50; --primary: #3498db; --card: #ffffff; --border: #ddd; --shadow: rgba(0, 0, 0, 0.05); --success: #28a745; }
        [data-theme="dark"] { --bg: #1a1a2e; --text: #e0e0e0; --primary: #1abc9c; --card: #2c2c40; --border: #444; --shadow: rgba(0, 0, 0, 0.15); }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); transition: background-color 0.3s ease, color 0.3s ease; line-height: 1.6; padding-top: 20px; }
        .reseller-container { max-width: 800px; margin: 0 auto; padding: 0 20px; text-align: center; }
        .reseller-card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; margin-top: 30px; }
        .reseller-card { background-color: var(--card); border: 2px solid var(--border); border-radius: 12px; padding: 30px; width: 100%; max-width: 350px; box-shadow: 0 8px 20px var(--shadow); transition: transform 0.3s ease, border-color 0.3s ease; }
        .reseller-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .btn-choose { background-color: var(--primary); color: white; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: 600; margin-top: 20px; display: inline-block; transition: background-color 0.2s ease; border: none; cursor: pointer; }
    </style>
</head>
<body data-theme="dark">
    <div class="reseller-container">
        <h1>Bergabunglah dengan Kami sebagai Reseller!</h1>
        <p>Dapatkan keuntungan dengan menjual produk digital berkualitas dari Asdar Store. Kami menyediakan sistem yang mudah, cepat, dan menguntungkan.</p>
        <h2>Pilih Paket Reseller Anda</h2>
        <div class="reseller-card-container">
            <div class="reseller-card">
                <h3>Reseller Paket A</h3>
                <p>Cocok untuk Anda yang serius berbisnis dan ingin keuntungan maksimal.</p>
                <button id="pilih-paket-a" class="btn-choose">Pilih Paket A</button>
            </div>
            <div class="reseller-card">
                <h3>Reseller Paket B</h3>
                <p>Pilihan tepat bagi pemula yang ingin memulai dengan modal kecil.</p>
                <button id="pilih-paket-b" class="btn-choose">Pilih Paket B</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // GANTI DENGAN KONFIGURASI FIREBASE ANDA
        const firebaseConfig = {
            apiKey: "AIzaSy...", // << ISI DENGAN KUNCI API ANDA
            authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
            databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
            projectId: "asdarstoredigitalll-d89c4",
            storageBucket: "asdarstoredigitalll-d89c4.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };
        
        // Inisialisasi Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- LOGIKA BARU YANG LEBIH AMAN ---
        auth.onAuthStateChanged(user => {
            // Kode di dalam sini HANYA akan berjalan SETELAH Firebase selesai memeriksa status login.

            function handlePackageSelection(paketPilihan) {
                if (user) {
                    // Jika user ADA (sudah login)
                    const namaPaket = `Paket ${paketPilihan}`;
                    if (confirm(`Anda akan memilih ${namaPaket} dan melanjutkan ke pembayaran. Lanjutkan?`)) {
                        const userDocRef = db.collection('users').doc(user.uid);
                        userDocRef.update({
                            status_reseller: 'menunggu_pembayaran',
                            paket_dipilih: paketPilihan
                        })
                        .then(() => {
                            alert('Pilihan Anda telah disimpan. Mengalihkan ke halaman pembayaran.');
                            window.location.href = 'deposit.html?paket=' + paketPilihan;
                        })
                        .catch(error => {
                            console.error("Gagal update status pengguna: ", error);
                            alert("Terjadi kesalahan, silakan coba lagi.");
                        });
                    }
                } else {
                    // Jika user TIDAK ADA (belum login)
                    alert('Anda harus login terlebih dahulu untuk memilih paket.');
                    window.location.href = 'index.html'; 
                }
            }

            // Pasang event listener tombol di dalam onAuthStateChanged
            document.getElementById('pilih-paket-a').addEventListener('click', () => {
                handlePackageSelection('A');
            });

            document.getElementById('pilih-paket-b').addEventListener('click', () => {
                handlePackageSelection('B');
            });
        });
    </script>
</body>
</html>
