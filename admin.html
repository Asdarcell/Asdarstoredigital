<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin Canggih</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { padding: 20px; background-color: #f5f5f5; }
    h1 { margin-bottom: 20px; }
    .card { margin-bottom: 20px; }
    img { max-width: 100px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Dashboard Admin - Asdar Store</h1><div class="row mb-3">
  <div class="col-md-4">
    <select id="filterStatus" class="form-select">
      <option value="">Filter Semua Status</option>
      <option value="Menunggu Pembayaran">Menunggu Pembayaran</option>
      <option value="Sudah Bayar">Sudah Bayar</option>
      <option value="Diproses">Diproses</option>
      <option value="Selesai">Selesai</option>
    </select>
  </div>
  <div class="col-md-4">
    <input id="searchId" type="text" class="form-control" placeholder="Cari ID Pesanan" />
  </div>
  <div class="col-md-4">
    <button onclick="exportCSV()" class="btn btn-success w-100">Export CSV</button>
  </div>
</div>

<div id="pesananList"></div>

<h3>Upload Bukti Admin ke Pembeli</h3>
<input type="file" id="buktiAdmin" class="form-control mb-2" accept="image/*">
<button onclick="uploadBukti()" class="btn btn-primary">Kirim Bukti & Selesaikan</button>

<hr>
<h3>Tambah Produk Baru</h3>
<form id="formProduk" class="row g-3">
  <div class="col-md-3">
    <input type="text" id="kategori" class="form-control" placeholder="Kategori Produk" required>
  </div>
  <div class="col-md-3">
    <input type="text" id="varian" class="form-control" placeholder="Varian / Nama Produk" required>
  </div>
  <div class="col-md-2">
    <input type="number" id="harga" class="form-control" placeholder="Harga (Rp)" required>
  </div>
  <div class="col-md-4">
    <input type="text" id="cara" class="form-control" placeholder="Keterangan/Cara Beli" required>
  </div>
  <div class="col-12">
    <button type="submit" class="btn btn-success">Simpan Produk</button>
  </div>
</form>

  </div>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>  <script>
    const imgbbApiKey = "f71ccc1a662c9f8656766990018d3a33";
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let selectedId = null;
    let allData = {};

    function tampilkanPesanan() {
      db.ref('pesanan').on('value', snapshot => {
        const data = snapshot.val();
        allData = data || {};
        const filter = document.getElementById('filterStatus').value;
        const search = document.getElementById('searchId').value.toLowerCase();

        let html = '';
        for (let id in allData) {
          const p = allData[id];
          if (filter && p.status !== filter) continue;
          if (search && !id.includes(search)) continue;

          html += `
            <div class="card">
              <div class="card-body">
                <b>ID:</b> ${id}<br>
                <b>Nama:</b> ${p.nama}<br>
                <b>Produk:</b> ${p.produk}<br>
                <b>Status:</b> ${p.status}<br>
                <b>Waktu:</b> ${p.waktu || '-'}<br>
                ${p.buktiBayar ? `<b>Bukti Pembeli:</b><br><img src="${p.buktiBayar}" />` : ''}
                ${p.buktiAdmin ? `<br><b>Bukti Admin:</b><br><img src="${p.buktiAdmin}" />` : ''}
                <br>
                <button onclick="setSelected('${id}')" class="btn btn-warning btn-sm">Pilih Kirim Bukti</button>
                <button onclick="verifikasi('${id}')" class="btn btn-info btn-sm">Proses</button>
              </div>
            </div>
          `;
        }
        document.getElementById('pesananList').innerHTML = html;
      });
    }

    function setSelected(id) {
      selectedId = id;
      alert('Dipilih: ' + id);
    }

    function verifikasi(id) {
      db.ref('pesanan/' + id).update({ status: 'Diproses' });
    }

    async function uploadBukti() {
      const file = document.getElementById('buktiAdmin').files[0];
      if (!file || !selectedId) return alert('Pilih pesanan dan gambar!');
      const formData = new FormData();
      formData.append('image', file);

      const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
        method: 'POST',
        body: formData
      });
      const result = await response.json();
      const imageUrl = result.data.url;

      await db.ref('pesanan/' + selectedId).update({
        buktiAdmin: imageUrl,
        status: 'Selesai'
      });
      alert('✅ Bukti dikirim. Status jadi Selesai.');
      selectedId = null;
    }

    function exportCSV() {
      let csv = 'ID,Nama,Produk,Status,Waktu\n';
      for (let id in allData) {
        const p = allData[id];
        csv += `${id},${p.nama},${p.produk},${p.status},${p.waktu || ''}\n`;
      }
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pesanan.csv';
      a.click();
    }

    document.getElementById('filterStatus').addEventListener('change', tampilkanPesanan);
    document.getElementById('searchId').addEventListener('input', tampilkanPesanan);

    document.getElementById('formProduk').addEventListener('submit', function(e) {
      e.preventDefault();
      const kategori = document.getElementById('kategori').value;
      const varian = document.getElementById('varian').value;
      const harga = document.getElementById('harga').value;
      const cara = document.getElementById('cara').value;

      const produkRef = db.ref('produk').push();
      produkRef.set({ kategori, varian, harga, cara });
      alert('✅ Produk ditambahkan.');
      this.reset();
    });

    tampilkanPesanan();
  </script></body>
</html>
