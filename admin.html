<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Admin Asdar Store Digital</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7ff;
      margin: 0; padding: 20px;
    }
    h1 {
      color: #007BFF;
      text-align: center;
      margin-bottom: 30px;
    }
    section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 40px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px 8px;
      text-align: left;
    }
    th {
      background: #007BFF;
      color: white;
    }
    button {
      background-color: #007BFF;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 6px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    .btn-danger {
      background-color: #dc3545;
    }
    .btn-danger:hover {
      background-color: #a71d2a;
    }
    img.bukti {
      max-width: 120px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1>Dashboard Admin Asdar Store Digital</h1>

  <section id="transaksiSection">
    <h2>Daftar Transaksi</h2>
    <table id="tableTransaksi">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nomor HP</th>
          <th>Produk</th>
          <th>Harga (Rp)</th>
          <th>Status</th>
          <th>Bukti Bayar</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data transaksi akan muncul di sini -->
      </tbody>
    </table>
  </section>

  <section id="testimoniSection">
    <h2>Daftar Testimoni</h2>
    <table id="tableTestimoni">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Isi Testimoni</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data testimoni akan muncul di sini -->
      </tbody>
    </table>
  </section>

  <!-- Tambahkan ke dalam file dashboard-admin.html --><section>
  <h2>ðŸ“¦ Manajemen Produk</h2>
  <form id="formProduk" onsubmit="tambahProduk(event)">
    <select id="kategoriProdukInput" required>
      <option value="">Pilih Kategori</option>
      <option value="kvision">K-Vision</option>
      <option value="nex">Nex Parabola</option>
      <option value="mnc">MNC Vision</option>
    </select>
    <input type="text" id="namaProdukInput" placeholder="Nama Produk" required />
    <input type="number" id="hargaProdukInput" placeholder="Harga (contoh: 30000)" required />
    <button type="submit">Tambah Produk</button>
  </form>  <table id="tableProduk">
    <thead>
      <tr>
        <th>ID</th>
        <th>Kategori</th>
        <th>Nama Produk</th>
        <th>Harga</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section><script>
// Tambah Produk
function tambahProduk(e) {
  e.preventDefault();
  const kategori = document.getElementById("kategoriProdukInput").value;
  const nama = document.getElementById("namaProdukInput").value.trim();
  const harga = parseInt(document.getElementById("hargaProdukInput").value);

  if (!kategori || !nama || !harga) return alert("Lengkapi semua field produk.");

  db.ref("produk").push({ kategori, nama, harga })
    .then(() => {
      alert("Produk berhasil ditambahkan!");
      document.getElementById("formProduk").reset();
    })
    .catch(() => alert("Gagal menambahkan produk."));
}

// Tampilkan Produk
function tampilkanProduk() {
  const tbody = document.querySelector("#tableProduk tbody");
  db.ref("produk").on("value", snapshot => {
    tbody.innerHTML = "";
    const data = snapshot.val();
    if (!data) {
      tbody.innerHTML = "<tr><td colspan='5'>Belum ada produk.</td></tr>";
      return;
    }
    Object.entries(data).forEach(([key, val]) => {
      const tr = document.createElement("tr");

      const tdID = document.createElement("td");
      tdID.textContent = key;

      const tdKat = document.createElement("td");
      tdKat.textContent = val.kategori;

      const tdNama = document.createElement("td");
      const namaInput = document.createElement("input");
      namaInput.value = val.nama;
      namaInput.onchange = () => updateProduk(key, { nama: namaInput.value });
      tdNama.appendChild(namaInput);

      const tdHarga = document.createElement("td");
      const hargaInput = document.createElement("input");
      hargaInput.type = "number";
      hargaInput.value = val.harga;
      hargaInput.onchange = () => updateProduk(key, { harga: parseInt(hargaInput.value) });
      tdHarga.appendChild(hargaInput);

      const tdAksi = document.createElement("td");
      const btnHapus = document.createElement("button");
      btnHapus.textContent = "Hapus";
      btnHapus.className = "btn-danger";
      btnHapus.onclick = () => hapusProduk(key);
      tdAksi.appendChild(btnHapus);

      tr.append(tdID, tdKat, tdNama, tdHarga, tdAksi);
      tbody.appendChild(tr);
    });
  });
}

function updateProduk(id, updateObj) {
  db.ref("produk/" + id).update(updateObj)
    .then(() => console.log("Produk diperbarui."))
    .catch(() => alert("Gagal update produk."));
}

function hapusProduk(id) {
  if (confirm("Yakin hapus produk ini?")) {
    db.ref("produk/" + id).remove()
      .then(() => alert("Produk dihapus."))
      .catch(() => alert("Gagal hapus produk."));
  }
}

// Jalankan saat halaman dimuat
window.addEventListener("load", tampilkanProduk);
</script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    // Konfigurasi Firebase (sama dengan proyek Anda)
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll-d89c4.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tbodyTransaksi = document.querySelector("#tableTransaksi tbody");
    const tbodyTestimoni = document.querySelector("#tableTestimoni tbody");

    // Fungsi menampilkan transaksi
    function tampilkanTransaksi() {
      db.ref("transaksi").on("value", snapshot => {
        tbodyTransaksi.innerHTML = ""; // Bersihkan tabel
        const data = snapshot.val();
        if (!data) {
          tbodyTransaksi.innerHTML = "<tr><td colspan='7'>Belum ada transaksi.</td></tr>";
          return;
        }
        Object.entries(data).forEach(([key, val], index) => {
          const tr = document.createElement("tr");

          const tdID = document.createElement("td");
          tdID.textContent = key;

          const tdNomor = document.createElement("td");
          tdNomor.textContent = val.nama || "-";

          const tdProduk = document.createElement("td");
          tdProduk.textContent = val.produkNama || "-";

          const tdHarga = document.createElement("td");
          tdHarga.textContent = val.harga ? val.harga.toLocaleString() : "-";

          const tdStatus = document.createElement("td");
          tdStatus.textContent = val.status || "-";

          const tdBukti = document.createElement("td");
          if (val.buktiBayarUrl) {
            const img = document.createElement("img");
            img.src = val.buktiBayarUrl;
            img.alt = "Bukti Bayar";
            img.className = "bukti";
            tdBukti.appendChild(img);
          } else {
            tdBukti.textContent = "-";
          }

          const tdAksi = document.createElement("td");

          // Tombol Update Status (Pending => Lunas)
          if (val.status === "Pending") {
            const btnUpdate = document.createElement("button");
            btnUpdate.textContent = "Set Lunas";
            btnUpdate.onclick = () => updateStatus(key, "Lunas");
            tdAksi.appendChild(btnUpdate);
          }

          // Tombol Hapus transaksi
          const btnHapus = document.createElement("button");
          btnHapus.textContent = "Hapus";
          btnHapus.className = "btn-danger";
          btnHapus.onclick = () => hapusTransaksi(key);
          tdAksi.appendChild(btnHapus);

          tr.append(tdID, tdNomor, tdProduk, tdHarga, tdStatus, tdBukti, tdAksi);
          tbodyTransaksi.appendChild(tr);
        });
      });
    }

    // Fungsi update status transaksi
    function updateStatus(id, statusBaru) {
      if (confirm(`Yakin ingin ubah status transaksi ini menjadi "${statusBaru}"?`)) {
        db.ref("transaksi/" + id).update({ status: statusBaru })
          .then(() => alert("Status berhasil diperbarui!"))
          .catch(() => alert("Gagal memperbarui status."));
      }
    }

    // Fungsi hapus transaksi
    function hapusTransaksi(id) {
      if (confirm("Yakin ingin menghapus transaksi ini?")) {
        db.ref("transaksi/" + id).remove()
          .then(() => alert("Transaksi berhasil dihapus!"))
          .catch(() => alert("Gagal menghapus transaksi."));
      }
    }

    // Fungsi menampilkan testimoni
    function tampilkanTestimoni() {
      db.ref("testimoni").on("value", snapshot => {
        tbodyTestimoni.innerHTML = ""; // Bersihkan tabel
        const data = snapshot.val();
        if (!data) {
          tbodyTestimoni.innerHTML = "<tr><td colspan='4'>Belum ada testimoni.</td></tr>";
          return;
        }
        Object.entries(data).forEach(([key, val], index) => {
          const tr = document.createElement("tr");

          const tdID = document.createElement("td");
          tdID.textContent = key;

          const tdNama = document.createElement("td");
          tdNama.textContent = val.nama || "-";

          const tdIsi = document.createElement("td");
          tdIsi.textContent = val.isi || "-";

          const tdAksi = document.createElement("td");
          const btnHapus = document.createElement("button");
          btnHapus.textContent = "Hapus";
          btnHapus.className = "btn-danger";
          btnHapus.onclick = () => hapusTestimoni(key);
          tdAksi.appendChild(btnHapus);

          tr.append(tdID, tdNama, tdIsi, tdAksi);
          tbodyTestimoni.appendChild(tr);
        });
      });
    }

    // Fungsi hapus testimoni
    function hapusTestimoni(id) {
      if (confirm("Yakin ingin menghapus testimoni ini?")) {
        db.ref("testimoni/" + id).remove()
          .then(() => alert("Testimoni berhasil dihapus!"))
          .catch(() => alert("Gagal menghapus testimoni."));
      }
    }

    // Inisialisasi tampilan data saat halaman siap
    window.onload = () => {
      tampilkanTransaksi();
      tampilkanTestimoni();
    };
  </script>
</body>
</html>
