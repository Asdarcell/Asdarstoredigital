<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - Asdar Store</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f9fa; }
    h1 { color: #2c3e50; }
    .pesanan { background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px #ccc; }
    .pesanan img { max-width: 100%; margin-top: 10px; }
    .btn-upload { margin-top: 10px; }
  </style>
</head>
<body>

  <h1>Dashboard Admin</h1>
  <div id="daftarPesanan">Memuat pesanan...</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll-d89c4.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();
  </script>

  <!-- Admin Logic -->
  <script>
    const daftar = document.getElementById("daftarPesanan");

    db.ref("pesanan").on("value", snap => {
      daftar.innerHTML = "";
      if (!snap.exists()) return daftar.innerHTML = "Belum ada pesanan.";

      snap.forEach(data => {
        const d = data.val();
        const key = data.key;
        daftar.innerHTML += `
          <div class="pesanan">
            <b>${d.nama}</b> (${d.nomor})<br>
            Produk: ${d.produk}<br>
            Tujuan: ${d.idProduk}<br>
            Status: <b>${d.status}</b><br>
            ${d.bukti_bayar ? `<img src="${d.bukti_bayar}" alt="Bukti bayar"/>` : '<i>Belum ada bukti bayar</i>'}<br>

            <input type="file" id="bukti_${key}" class="btn-upload" /><br>
            <button onclick="verifikasi('${key}')">Tandai Selesai</button>
          </div>
        `;
      });
    });

    function verifikasi(key) {
      const fileInput = document.getElementById("bukti_" + key);
      const file = fileInput.files[0];
      if (!file) return alert("Pilih gambar bukti selesai!");

      const ref = storage.ref("bukti_selesai/" + key + "_" + Date.now());
      ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
        db.ref("pesanan/" + key).update({
          status: "Selesai",
          bukti_selesai: url
        }).then(() => alert("Pesanan ditandai selesai!"));
      });
    }
  </script>

</body>
</html>
