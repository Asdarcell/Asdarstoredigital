<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Admin - Asdar Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { padding: 20px; background-color: #f5f5f5; font-family: 'Poppins', sans-serif; }
    h1 { margin-bottom: 20px; }
    .card { margin-bottom: 15px; }
    .btn-group-custom { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; }
  </style>
</head>
<body>
<div class="container">
  <h1>Dashboard Admin - Asdar Store</h1>

  <!-- Filter dan Pencarian -->
  <div class="row mb-3">
    <div class="col-md-4 mb-2">
      <select id="filterStatus" class="form-select">
        <option value="">Filter Semua Status</option>
        <option value="Belum Bayar">Belum Bayar</option>
        <option value="Sudah Bayar">Sudah Bayar</option>
        <option value="Diproses">Diproses</option>
        <option value="Selesai">Selesai</option>
      </select>
    </div>
    <div class="col-md-4 mb-2">
      <input type="text" id="searchId" class="form-control" placeholder="Cari ID Pesanan" />
    </div>
    <div class="col-md-4 mb-2">
      <button class="btn btn-success w-100" id="exportCSVBtn">Export CSV</button>
    </div>
  </div>

  <!-- Tombol Tambahan -->
  <div class="btn-group-custom">
    <button class="btn btn-outline-secondary btn-sm" onclick="tampilkanPesanan()">🔄 Tampilkan Semua Pesanan</button>
    <button class="btn btn-outline-danger btn-sm" onclick="hapusSemuaPesanan()">🗑️ Hapus Semua Pesanan</button>
  </div>

  <!-- Hapus Berdasarkan Status -->
  <div class="mb-3">
    <label for="hapusStatus" class="form-label">Hapus Pesanan Berdasarkan Status:</label>
    <div class="input-group">
      <select id="hapusStatus" class="form-select">
        <option value="">-- Pilih Status --</option>
        <option value="Belum Bayar">Belum Bayar</option>
        <option value="Sudah Bayar">Sudah Bayar</option>
        <option value="Diproses">Diproses</option>
        <option value="Selesai">Selesai</option>
      </select>
      <button class="btn btn-danger" onclick="hapusPesananBerdasarkanStatus()">🗑️ Hapus Status Tertentu</button>
    </div>
  </div>

  <!-- List Pesanan -->
  <div id="pesananList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function tampilkanPesanan() {
      db.ref('pesanan').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        const filter = document.getElementById('filterStatus').value;
        const search = document.getElementById('searchId').value.toLowerCase();
        const container = document.getElementById('pesananList');
        container.innerHTML = '';

        for (const id in data) {
          const p = data[id];
          if (filter && p.status !== filter) continue;
          if (search && !id.toLowerCase().includes(search)) continue;

          container.innerHTML += `
            <div class="card">
              <div class="card-body">
                <b>ID:</b> ${id}<br>
                <b>Nama:</b> ${p.nama}<br>
                <b>Status:</b> ${p.status}<br>
              </div>
            </div>`;
        }
      });
    }

    function hapusSemuaPesanan() {
      const konfirmasi = prompt("Ketik 'hapussemua' untuk konfirmasi hapus SEMUA pesanan:");
      if (konfirmasi !== "hapussemua") return alert("❌ Dibatalkan");
      db.ref('pesanan').remove().then(() => {
        alert("✅ Semua pesanan berhasil dihapus.");
        tampilkanPesanan();
      });
    }

    function hapusPesananBerdasarkanStatus() {
      const status = document.getElementById('hapusStatus').value;
      if (!status) return alert("❗ Silakan pilih status yang ingin dihapus.");

      const konfirmasi = prompt(`Ketik 'hapus-${status.replace(/\\s/g, '').toLowerCase()}' untuk hapus semua pesanan dengan status \"${status}\"`);
      if (konfirmasi !== `hapus-${status.replace(/\\s/g, '').toLowerCase()}`) return alert("❌ Dibatalkan");

      db.ref('pesanan').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        const updates = {};
        for (const id in data) {
          if (data[id].status === status) updates[id] = null;
        }

        if (Object.keys(updates).length === 0) return alert(`⚠️ Tidak ada pesanan dengan status \"${status}\"`);

        db.ref('pesanan').update(updates).then(() => {
          alert(`✅ Semua pesanan dengan status \"${status}\" berhasil dihapus.`);
          tampilkanPesanan();
        });
      });
    }

    document.getElementById('filterStatus').addEventListener('change', tampilkanPesanan);
    document.getElementById('searchId').addEventListener('input', tampilkanPesanan);
    document.getElementById('exportCSVBtn').addEventListener('click', () => alert("Fitur export CSV belum ditambahkan di versi ini"));

    tampilkanPesanan();
  </script>
</div>
</body>
</html>
