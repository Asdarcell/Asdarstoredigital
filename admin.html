<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Asdar Store Digital</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .btn-sm { padding: .25rem .5rem; font-size: .75rem; }
    .overflow-auto { max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Dashboard Admin - Asdar Store</h1><div class="section">
  <h4>Pengaturan Umum</h4>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="fiturStatus" />
    <label class="form-check-label" for="fiturStatus">Tampilkan Cek Status Pesanan</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="fiturTesti" />
    <label class="form-check-label" for="fiturTesti">Tampilkan Testimoni Pelanggan</label>
  </div>
  <label class="mt-3">Banner Promo:</label>
  <textarea id="banner" class="form-control" placeholder="Contoh: Promo Diskon 20% sampai 10 Juli!"></textarea>
  <button class="btn btn-success mt-2" onclick="simpanPengaturan()">Simpan Pengaturan</button>
</div>

<div class="section">
  <h4>Tambah / Edit Produk</h4>
  <form id="formProduk" class="row g-3 mb-3">
    <div class="col-md-3"><input type="text" id="inputKategori" class="form-control" placeholder="Kategori Produk" required /></div>
    <div class="col-md-3"><input type="text" id="varian" class="form-control" placeholder="Varian / Nama Produk" required /></div>
    <div class="col-md-2"><input type="number" id="harga" class="form-control" placeholder="Harga (Rp)" required /></div>
    <div class="col-md-4"><input type="text" id="cara" class="form-control" placeholder="Keterangan / Cara Beli" required /></div>
    <div class="col-12"><button type="submit" class="btn btn-primary">Simpan / Edit Produk</button></div>
  </form>
  <ul class="list-group overflow-auto" id="daftarProduk"></ul>
</div>

<div class="section">
  <h4>Daftar Pesanan</h4>
  <ul class="list-group overflow-auto" id="daftarPesanan"></ul>
</div>

<div class="section">
  <h4>Upload Bukti Transaksi Selesai</h4>
  <form id="formBukti">
    <div class="mb-3">
      <label for="noHpBukti" class="form-label">Nomor HP Pembeli</label>
      <input type="text" id="noHpBukti" class="form-control" required />
    </div>
    <div class="mb-3">
      <label for="fileBukti" class="form-label">Pilih File Bukti Transfer</label>
      <input type="file" id="fileBukti" class="form-control" accept="image/*" required />
    </div>
    <button type="submit" class="btn btn-success">Upload Bukti</button>
  </form>
</div>

  </div>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    function simpanPengaturan() {
      const fiturStatus = document.getElementById('fiturStatus').checked;
      const fiturTesti = document.getElementById('fiturTesti').checked;
      const banner = document.getElementById('banner').value.trim();
      db.ref('pengaturan').set({ fiturStatus, fiturTesti, banner })
        .then(() => alert('Pengaturan berhasil disimpan!'))
        .catch(e => alert('Gagal simpan pengaturan: ' + e.message));
    }

    const formProduk = document.getElementById('formProduk');
    const daftarProduk = document.getElementById('daftarProduk');
    const produkRef = db.ref('produk');

    formProduk.addEventListener('submit', e => {
      e.preventDefault();
      const kategori = document.getElementById('inputKategori').value.trim();
      const varian = document.getElementById('varian').value.trim();
      const harga = parseInt(document.getElementById('harga').value);
      const cara = document.getElementById('cara').value.trim();
      if (!kategori || !varian || !harga || !cara) return alert('Lengkapi semua field produk!');
      db.ref(`produk/${kategori}/${varian}`).set({ harga, deskripsi: cara })
        .then(() => {
          alert('Produk berhasil disimpan!');
          formProduk.reset();
          tampilkanProduk();
        })
        .catch(e => alert('Gagal simpan produk: ' + e.message));
    });

    function tampilkanProduk() {
      daftarProduk.innerHTML = '';
      produkRef.once('value').then(snapshot => {
        const data = snapshot.val() || {};
        for (let kategori in data) {
          for (let varian in data[kategori]) {
            const p = data[kategori][varian];
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `<div><b>${kategori}</b> - ${varian} | Rp${p.harga}<br/><small>${p.deskripsi || ''}</small></div>
              <button class="btn btn-sm btn-danger" onclick="hapusProduk('${kategori}','${varian}')">Hapus</button>`;
            daftarProduk.appendChild(li);
          }
        }
      });
    }

    function hapusProduk(kategori, varian) {
      if (!confirm(`Hapus produk ${kategori} - ${varian}?`)) return;
      db.ref(`produk/${kategori}/${varian}`).remove()
        .then(() => {
          alert('Produk dihapus');
          tampilkanProduk();
        });
    }
    tampilkanProduk();

    const daftarPesanan = document.getElementById('daftarPesanan');
    function tampilkanPesanan() {
      daftarPesanan.innerHTML = '';
      db.ref('pesanan').orderByChild('waktu').limitToLast(100).once('value').then(snapshot => {
        const pesanan = [];
        snapshot.forEach(child => {
          pesanan.push({ id: child.key, ...child.val() });
        });
        pesanan.reverse();
        pesanan.forEach(p => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.innerHTML = `<div><b>ID:</b> ${p.id}</div>
            <div><b>Nama:</b> ${p.nama} | <b>Nomor:</b> ${p.nomor}</div>
            <div><b>Produk:</b> ${p.produk} | <b>Harga:</b> Rp${p.harga}</div>
            <div><b>Status:</b> ${p.status}</div>
            <button class="btn btn-sm btn-danger mt-2" onclick="hapusPesanan('${p.id}')">Hapus</button>`;
          daftarPesanan.appendChild(li);
        });
      });
    }
    tampilkanPesanan();

    function hapusPesanan(id) {
      if (!confirm('Hapus pesanan ini?')) return;
      db.ref('pesanan/' + id).remove()
        .then(() => {
          alert('Pesanan dihapus');
          tampilkanPesanan();
        });
    }

    const formBukti = document.getElementById('formBukti');
    formBukti.addEventListener('submit', e => {
      e.preventDefault();
      const noHp = document.getElementById('noHpBukti').value.trim();
      const file = document.getElementById('fileBukti').files[0];
      if (!noHp || !file) return alert('Lengkapi nomor HP dan pilih file bukti!');
      const filePath = `buktiBayar/${noHp}/${Date.now()}_${file.name}`;
      const uploadTask = storage.ref(filePath).put(file);
      uploadTask.on('state_changed', null, error => {
        alert('Upload gagal: ' + error.message);
      }, () => {
        uploadTask.snapshot.ref.getDownloadURL().then(url => {
          db.ref('pesanan').orderByChild('nomor').equalTo(noHp).limitToFirst(1).once('value').then(snapshot => {
            if (snapshot.exists()) {
              const key = Object.keys(snapshot.val())[0];
              db.ref('pesanan/' + key).update({ buktiBayarUrl: url, status: 'Menunggu Verifikasi' })
                .then(() => {
                  alert('Bukti bayar berhasil diupload dan status diupdate!');
                  formBukti.reset();
                  tampilkanPesanan();
                });
            } else {
              alert('Nomor HP tidak ditemukan di pesanan!');
            }
          });
        });
      });
    });
  </script></body>
</html>
