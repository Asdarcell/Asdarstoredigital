<!DOCTYPE html>  <html lang="id">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Admin & Pemesanan - Asdar Store Digital</title>  
  <link rel="icon" href="favicon.png" />  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />  
  <style>  
    :root {  
      --bg: #f9f9f9;  
      --text: #2c3e50;  
      --primary: #3498db;  
      --card: #ffffff;  
    }  
    [data-theme="dark"] {  
      --bg: #121212;  
      --text: #f1f1f1;  
      --primary: #1abc9c;  
      --card: #1e1e1e;  
    }  
    body {  
      font-family: 'Poppins', sans-serif;  
      background: var(--bg);  
      color: var(--text);  
      transition: all 0.3s ease;  
      margin: 0;  
      padding: 20px;  
    }  
    header {  
      position: sticky;  
      top: 0;  
      background: var(--card);  
      padding: 15px 20px;  
      display: flex;  
      justify-content: space-between;  
      align-items: center;  
      border-bottom: 1px solid #ddd;  
      z-index: 999;  
      margin-bottom: 20px;  
    }  
    header h1 {  
      margin: 0;  
      font-size: 20px;  
    }  
    .theme-btn {  
      background: transparent;  
      border: none;  
      font-size: 20px;  
      cursor: pointer;  
      color: var(--primary);  
    }  
    main {  
      max-width: 1000px;  
      margin: auto;  
    }  
    label {  
      font-weight: 600; margin-top: 10px; display: block;  
    }  
    input, select, button, textarea {  
      width: 100%; padding: 10px; margin: 8px 0;  
      border-radius: 8px; border: 1px solid #ccc;  
      transition: 0.3s;  
      font-family: 'Poppins', sans-serif;  
      font-size: 1rem;  
    }  
    button {  
      background: var(--primary); color: white;  
      cursor: pointer; font-weight: bold;  
    }  
    .info {  
      background: var(--card); padding: 12px; margin-top: 10px;  
      border-left: 4px solid var(--primary); border-radius: 5px;  
    }  
    #testimoniBox {  
      background: var(--card);  
      padding: 10px;  
      border-left: 4px solid var(--primary);  
      border-radius: 6px;  
      min-height: 80px;  
      margin-top: 20px;  
      position: relative;  
      overflow: hidden;  
    }  
    #animTestimoni {  
      position: absolute;  
      width: 100%;  
      transition: opacity 0.5s ease;  
      opacity: 1;  
    }  
    .qr-btn {  
      margin-top: 10px;  
      background: #000;  
      color: #fff;  
      padding: 10px;  
      text-align: center;  
      border-radius: 6px;  
      text-decoration: none;  
      display: inline-block;  
    }  /* Dashboard admin styles */  
.section {  
  background: var(--card);  
  padding: 20px;  
  border-radius: 8px;  
  margin-bottom: 20px;  
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);  
}  
.btn-sm { padding: .25rem .5rem; font-size: .75rem; }  
.overflow-auto { max-height: 300px; overflow-y: auto; }  
textarea, input[type=text], input[type=number] { width: 100%; }  

/* Tabs */  
.nav-tabs {  
  margin-bottom: 20px;  
}

  </style>  
</head>  
<body data-theme="light">  
  <header>  
    <h1>Asdar Store Digital - Admin & Pemesanan</h1>  
    <button class="theme-btn" onclick="toggleTheme()" id="themeToggle">ðŸŒ™</button>  
  </header>    <main>  
    <!-- NAVIGATION TABS -->  
    <ul class="nav nav-tabs" id="tabMenu" role="tablist">  
      <li class="nav-item" role="presentation">  
        <button class="nav-link active" id="tab-pesan" data-bs-toggle="tab" data-bs-target="#tabPesan" type="button" role="tab">Form Pemesanan</button>  
      </li>  
      <li class="nav-item" role="presentation">  
        <button class="nav-link" id="tab-admin" data-bs-toggle="tab" data-bs-target="#tabAdmin" type="button" role="tab">Dashboard Admin</button>  
      </li>  
    </ul>  <div class="tab-content" id="tabContent">  
  <!-- FORM PEMESANAN -->  
  <div class="tab-pane fade show active" id="tabPesan" role="tabpanel" aria-labelledby="tab-pesan">  
    <form id="formPesanan">  
      <label for="nama">Nama Lengkap</label>  
      <input type="text" id="nama" required />  
      <label for="nomor">Nomor HP / ID SN</label>  
      <input type="text" id="nomor" required />  
      <label for="kategori">Kategori Produk</label>  
      <select id="kategori" required><option value="">Pilih Kategori</option></select>  
      <label for="produk">Produk</label>  
      <select id="produk" required><option value="">Pilih Produk</option></select>  
      <div class="info" id="infoProduk">Harga dan deskripsi akan muncul di sini...</div>  
      <button type="submit">Pesan Sekarang</button>  
    </form>  
    <div id="hasil"></div>  

    <hr><br>  
    <h2>Cek Status Pesanan</h2>  
    <form onsubmit="event.preventDefault(); cekStatus();">  
      <input type="text" id="idCek" placeholder="Masukkan ID Pesanan" required />  
      <button type="submit">Cek Status</button>  
    </form>  

    <hr><br>  
    <h2>Testimoni Pelanggan</h2>  
    <div id="testimoniBox"><div id="animTestimoni">Loading...</div></div>  
  </div>  

  <!-- DASHBOARD ADMIN -->  
  <div class="tab-pane fade" id="tabAdmin" role="tabpanel" aria-labelledby="tab-admin">  
    <!-- PENGATURAN UMUM -->  
    <div class="section">  
      <h4>Pengaturan Umum</h4>  
      <div class="form-check">  
        <input class="form-check-input" type="checkbox" id="fiturStatus" />  
        <label class="form-check-label" for="fiturStatus">Tampilkan Cek Status Pesanan</label>  
      </div>  
      <div class="form-check">  
        <input class="form-check-input" type="checkbox" id="fiturTesti" />  
        <label class="form-check-label" for="fiturTesti">Tampilkan Testimoni Pelanggan</label>  
      </div>  
      <label class="mt-3">Banner Promo:</label>  
      <textarea id="banner" placeholder="Contoh: Promo Diskon 20% sampai 10 Juli!"></textarea>  
      <button class="btn btn-success mt-2" onclick="simpanPengaturan()">Simpan Pengaturan</button>  
    </div>  

    <!-- PRODUK -->  
    <div class="section">  
      <h4>Tambah / Edit Produk</h4>  
      <form id="formProduk" class="row g-3 mb-3">  
        <div class="col-md-3"><input type="text" id="inputKategori" class="form-control" placeholder="Kategori Produk" required /></div>  
        <div class="col-md-3"><input type="text" id="varian" class="form-control" placeholder="Varian / Nama Produk" required /></div>  
        <div class="col-md-2"><input type="number" id="harga" class="form-control" placeholder="Harga (Rp)" required /></div>  
        <div class="col-md-4"><input type="text" id="cara" class="form-control" placeholder="Keterangan / Cara Beli" required /></div>  
        <div class="col-12"><button type="submit" class="btn btn-primary">Simpan / Edit Produk</button></div>  
      </form>  
      <ul class="list-group overflow-auto" id="daftarProduk"></ul>  
    </div>  

    <!-- FITUR BEBAS -->  
    <div class="section">  
      <h4>Fitur Bebas (Custom Section)</h4>  
      <div class="input-group mb-2">  
        <input type="text" class="form-control" id="judulFitur" placeholder="Judul Fitur (misal: Cara Bayar)" />  
      </div>  
      <div class="mb-2">  
        <textarea id="isiFitur" placeholder="Isi HTML fitur bebas di sini"></textarea>  
      </div>  
      <button class="btn btn-secondary" onclick="tambahFitur()">Tambah / Perbarui Fitur</button>  
      <ul class="list-group mt-3 overflow-auto" id="daftarFitur"></ul>  
    </div>  

    <!-- DAFTAR PESANAN -->  
    <div class="section">  
      <h4>Daftar Pesanan</h4>  
      <ul class="list-group overflow-auto" id="daftarPesanan"></ul>  
    </div>  

    <!-- UPLOAD BUKTI TRANSAKSI -->  
    <div class="section">  
      <h4>Upload Bukti Transaksi Selesai</h4>  
      <form id="formBukti">  
        <div class="mb-3">  
          <label for="noHpBukti" class="form-label">Nomor HP Pembeli</label>  
          <input type="text" id="noHpBukti" class="form-control" placeholder="Masukkan nomor HP pembeli" required />  
        </div>  
        <div class="mb-3">  
          <label for="fileBukti" class="form-label">Pilih File Bukti Transfer</label>  
          <input type="file" id="fileBukti" class="form-control" accept="image/*" required />  
        </div>  
        <button type="submit" class="btn btn-success">Upload Bukti</button>  
      </form>  
    </div>  
  </div>  
</div>

  </main>    <!-- Firebase & Bootstrap JS -->    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>    <script>  
    // THEME TOGGLE  
    function toggleTheme() {  
      const body = document.body;  
      const btn = document.getElementById('themeToggle');  
      const next = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';  
      body.setAttribute('data-theme', next);  
      btn.textContent = next === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';  
      localStorage.setItem('theme', next);  
    }  
    if (localStorage.getItem('theme')) {  
      document.body.setAttribute('data-theme', localStorage.getItem('theme'));  
      document.getElementById('themeToggle').textContent = localStorage.getItem('theme') === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';  
    }  
  
    // Firebase config & init  
    const firebaseConfig = {  
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",  
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",  
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",  
      projectId: "asdarstoredigitalll-d89c4",  
      storageBucket: "asdarstoredigitalll.appspot.com",  
      messagingSenderId: "220670500351",  
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"  
    };  
    firebase.initializeApp(firebaseConfig);  
    const db = firebase.database();  
    const storage = firebase.storage();  
  
    // --- FORM PEMESANAN ---  
    const kategoriSelect = document.getElementById('kategori');  
    const produkSelect = document.getElementById('produk');  
    const infoProduk = document.getElementById('infoProduk');  
    const hasil = document.getElementById('hasil');  
    const produkRef = db.ref('produk');  
  
    // Load kategori pilihan  
    produkRef.once('value').then(snapshot => {  
      const data = snapshot.val();  
      kategoriSelect.innerHTML = '<option value="">Pilih Kategori</option>';  
      for (let kategori in data) {  
        kategoriSelect.innerHTML += `<option value="${kategori}">${kategori}</option>`;  
      }  
    });  
  
    // Saat kategori berubah, isi produk  
    kategoriSelect.addEventListener('change', () => {  
      produkSelect.innerHTML = '<option value="">Pilih Produk</option>';  
      infoProduk.innerHTML = 'Harga dan deskripsi akan muncul di sini...';  
      const kategori = kategoriSelect.value;  
      if (!kategori) return;  
      produkRef.child(kategori).once('value').then(snapshot => {  
        const data = snapshot.val();  
        for (let nama in data) {  
          produkSelect.innerHTML += `<option value="${nama}">${nama}</option>`;  
        }  
      });  
    });  
  
    // Saat produk dipilih, tampilkan harga dan deskripsi  
    produkSelect.addEventListener('change', () => {  
      const kategori = kategoriSelect.value;  
      const produk = produkSelect.value;  
      if (!produk) return;  
      produkRef.child(`${kategori}/${produk}`).once('value').then(snapshot => {  
        const data = snapshot.val();  
        infoProduk.innerHTML = `<b>Harga:</b> Rp${data.harga}<br><b>Deskripsi:</b> ${data.deskripsi || data.cara}`;  
      });  
    });  
  
    // Submit form pesanan  
    document.getElementById('formPesanan').addEventListener('submit', e => {  
      e.preventDefault();  
      const nama = document.getElementById('nama').value.trim();  
      const nomor = document.getElementById('nomor').value.trim();  
      const kategori = kategoriSelect.value;  
      const produk = produkSelect.value;  
      const waktu = new Date().toISOString();  
      const id = "P" + Date.now();  
      if (!nama || !nomor || !kategori || !produk) return alert("Harap lengkapi semua field!");  
      produkRef.child(`${kategori}/${produk}`).once('value').then(snap => {  
        const data = snap.val();  
        const harga = parseInt(data.harga) || 0;  
        db.ref('pesanan/' + id).set({   
          nama,   
          nomor,   
          kategori,   
          produk,   
          harga,   
          waktu,   
          status: 'Belum Bayar'   
        }).then(() => {  
          hasil.innerHTML = `  
  âœ… Pesanan berhasil!<br/><b>ID:</b> ${id}<br/>  
  <img src="https://asdarcell.github.io/Asdarstoredigital/1751966264423.jpg" alt="QRIS" style="width: 100%; max-width: 300px;" />  
  <div class="info">  
    ðŸŸ£ <b>PAYMENT</b><br/>  
    ShopeePay: <b>081803004607</b><br/>  
    Dana: <b>087755432880</b>  
  </div>  
  <a class='qr-btn' href="upload.html?id=${id}">ðŸ“¤ Upload Bukti Bayar</a><br/>  
  <a class='qr-btn' href="status.html?id=${id}">ðŸ“„ Cek Status</a><br/>  
  <a class='qr-btn' style="background:#00a8e8;" href="intent://sendmoney?phone=087755432880&amount=${harga}#Intent;scheme=dana;package=id.dana;end">ðŸ’¸ Bayar via Dana</a><br/>  
  <a class='qr-btn' style="background:#ee4d2d;" href="intent://send?phone=081803004607&amount=${harga}#Intent;scheme=shopeepay;package=com.shopee.id;end">ðŸ›’ Bayar via ShopeePay</a>  
`;  
          document.getElementById('formPesanan').reset();  
          infoProduk.innerHTML = 'Harga dan deskripsi akan muncul di sini...';  
          kirimNotifWA(id, nama, produk);  
          // Refresh daftar pesanan di admin tab jika sudah terbuka  
          tampilkanPesanan();  
        });  
      });  
    });  
  
    function cekStatus() {  
      const id = document.getElementById('idCek').value  
    function cekStatus() {
      const id = document.getElementById('idCek').value.trim();
      if (!id) return alert('Masukkan ID Pesanan!');
      db.ref('pesanan/' + id).once('value').then(snapshot => {
        const data = snapshot.val();
        if (!data) {
          alert('Pesanan tidak ditemukan!');
          return;
        }
        let info = `
          <div class="info">
            <b>ID Pesanan:</b> ${id}<br/>
            <b>Nama:</b> ${data.nama}<br/>
            <b>Nomor:</b> ${data.nomor}<br/>
            <b>Produk:</b> ${data.produk}<br/>
            <b>Harga:</b> Rp${data.harga}<br/>
            <b>Status:</b> ${data.status}<br/>
        `;
        if (data.buktiBayarUrl) {
          info += `<b>Bukti Bayar:</b><br/><img src="${data.buktiBayarUrl}" alt="Bukti Bayar" style="max-width: 100%; height: auto; border-radius: 8px;" />`;
        }
        info += '</div>';
        hasil.innerHTML = info;
      });
    }

    // Fungsi kirim notifikasi WA ke admin
    function kirimNotifWA(id, nama, produk) {
      // Contoh endpoint notifikasi WA, ganti dengan API kamu sendiri
      const nomorAdmin = "081803004607"; // Nomor admin WA
      const pesan = `Pesanan baru:\nID: ${id}\nNama: ${nama}\nProduk: ${produk}`;
      // Contoh fetch notifikasi WA, sesuaikan API notifikasi WA yang kamu pakai
      fetch('https://api.ngirimwa.com/send-message', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          phone: nomorAdmin,
          message: pesan
        })
      }).then(res => {
        if (!res.ok) throw new Error('Gagal kirim notifikasi WA');
        console.log('Notifikasi WA terkirim');
      }).catch(err => console.error(err));
    }

    // --- TESTIMONI BERJALAN ---
    const testiBox = document.getElementById('animTestimoni');
    let testimoniList = [];
    let testiIndex = 0;

    function loadTestimoni() {
      db.ref('testimoni').once('value').then(snapshot => {
        testimoniList = [];
        snapshot.forEach(childSnap => {
          const t = childSnap.val();
          if (t.nama && t.pesan) testimoniList.push(t);
        });
        if (testimoniList.length > 0) {
          testiIndex = 0;
          showTestimoni();
        } else {
          testiBox.textContent = 'Belum ada testimoni.';
        }
      });
    }

    function showTestimoni() {
      if (testimoniList.length === 0) return;
      const t = testimoniList[testiIndex];
      testiBox.style.opacity = 0;
      setTimeout(() => {
        testiBox.innerHTML = `<b>${t.nama}</b><br/>${t.pesan}`;
        testiBox.style.opacity = 1;
      }, 500);
      testiIndex = (testiIndex + 1) % testimoniList.length;
      setTimeout(showTestimoni, 4000);
    }

    loadTestimoni();

    // --- DASHBOARD ADMIN ---

    // Simpan pengaturan umum
    function simpanPengaturan() {
      const fiturStatus = document.getElementById('fiturStatus').checked;
      const fiturTesti = document.getElementById('fiturTesti').checked;
      const banner = document.getElementById('banner').value.trim();
      db.ref('pengaturan').set({ fiturStatus, fiturTesti, banner })
        .then(() => alert('Pengaturan berhasil disimpan!'))
        .catch(e => alert('Gagal simpan pengaturan: ' + e.message));
    }

    // Load pengaturan umum ke form admin
    function loadPengaturan() {
      db.ref('pengaturan').once('value').then(snapshot => {
        const p = snapshot.val() || {};
        document.getElementById('fiturStatus').checked = p.fiturStatus || false;
        document.getElementById('fiturTesti').checked = p.fiturTesti || false;
        document.getElementById('banner').value = p.banner || '';
      });
    }
    loadPengaturan();

    // Tambah atau edit produk
    const formProduk = document.getElementById('formProduk');
    formProduk.addEventListener('submit', e => {
      e.preventDefault();
      const kategori = document.getElementById('inputKategori').value.trim();
      const varian = document.getElementById('varian').value.trim();
      const harga = parseInt(document.getElementById('harga').value);
      const cara = document.getElementById('cara').value.trim();
      if (!kategori || !varian || !harga || !cara) return alert('Lengkapi semua field produk!');
      const produkData = { harga, deskripsi: cara };
      db.ref(`produk/${kategori}/${varian}`).set(produkData)
        .then(() => {
          alert('Produk berhasil disimpan!');
          formProduk.reset();
          tampilkanProduk();
        })
        .catch(e => alert('Gagal simpan produk: ' + e.message));
    });

    // Tampilkan daftar produk di admin
    const daftarProduk = document.getElementById('daftarProduk');
    function tampilkanProduk() {
      daftarProduk.innerHTML = '';
      produkRef.once('value').then(snapshot => {
        const data = snapshot.val() || {};
        for (let kategori in data) {
          const produk = data[kategori];
          for (let varian in produk) {
            const p = produk[varian];
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `
              <div><b>${kategori}</b> - ${varian} | Rp${p.harga}<br/><small>${p.deskripsi || ''}</small></div>
              <button class="btn btn-sm btn-danger" onclick="hapusProduk('${kategori}','${varian}')">Hapus</button>
            `;
            daftarProduk.appendChild(li);
          }
        }
      });
    }
    tampilkanProduk();

    function hapusProduk(kategori, varian) {
      if (!confirm(`Hapus produk ${kategori} - ${varian}?`)) return;
      db.ref(`produk/${kategori}/${varian}`).remove()
        .then(() => {
          alert('Produk dihapus');
          tampilkanProduk();
        });
    }

    // --- DAFTAR PESANAN ---
    const daftarPesanan = document.getElementById('daftarPesanan');
    function tampilkanPesanan() {
      daftarPesanan.innerHTML = '';
      db.ref('pesanan').orderByChild('waktu').limitToLast(100).once('value').then(snapshot => {
        const pesanan = [];
        snapshot.forEach(childSnap => {
          pesanan.push({ id: childSnap.key, ...childSnap.val() });
        });
        pesanan.reverse(); // terbaru atas
        pesanan.forEach(p => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.innerHTML = `
            <div><b>ID:</b> ${p.id}</div>
            <div><b>Nama:</b> ${p.nama} | <b>Nomor:</b> ${p.nomor}</div>
            <div><b>Produk:</b> ${p.produk} | <b>Harga:</b> Rp${p.harga}</div>
            <div><b>Status:</b> ${p.status}</div>
            <button class="btn btn-sm btn-danger mt-2" onclick="hapusPesanan('${p.id}')">Hapus</button>
          `;
          daftarPesanan.appendChild(li);
        });
      });
    }
    tampilkanPesanan();

    function hapusPesanan(id) {
      if (!confirm('Hapus pesanan ini?')) return;
      db.ref('pesanan/' + id).remove()
        .then(() => {
          alert('Pesanan dihapus');
          tampilkanPesanan();
        });
    }

    // --- UPLOAD BUKTI BAYAR ---
    const formBukti = document.getElementById('formBukti');
    formBukti.addEventListener('submit', e => {
      e.preventDefault();
      const noHp = document.getElementById('noHpBukti').value.trim();
      const file = document.getElementById('fileBukti').files[0];
      if (!noHp || !file) return alert('Lengkapi nomor HP dan pilih file bukti!');
      const filePath = `buktiBayar/${noHp}/${Date.now()}_${file.name}`;
      const uploadTask = storage.ref(filePath).put(file);
      uploadTask.on('state_changed', null, error => {
        alert('Upload gagal: ' + error.message);
      }, () => {
        uploadTask.snapshot.ref.getDownloadURL().then(url => {
          // Update data pesanan dengan buktiBayarUrl
          db.ref('pesanan').orderByChild('nomor').equalTo(noHp).limitToFirst(1).once('value').then(snapshot => {
            if (snapshot.exists()) {
              const key = Object.keys(snapshot.val())[0];
              db.ref('pesanan/' + key).update({ buktiBayarUrl: url, status: 'Menunggu Verifikasi' })
                .then(() => {
                  alert('Bukti bayar berhasil diupload dan status diupdate!');
                  formBukti.reset();
                  tampilkanPesanan();
                });
            } else {
              alert('Nomor HP tidak ditemukan di pesanan!');
            }
          });
        });
      });
    });

  </script>
</body>
</html>
