<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asdar Store Digital</title>
  <link rel="icon" href="favicon.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    /* Variabel Tema */
    :root {
      --bg: #f9f9f9;
      --text: #2c3e50;
      --primary: #3498db;
      --card: #ffffff;
      --border: #ddd;
      --shadow: rgba(0, 0, 0, 0.05);
    }

    [data-theme="dark"] {
      --bg: #1a1a2e;
      --text: #e0e0e0;
      --primary: #1abc9c;
      --card: #2c2c40;
      --border: #444;
      --shadow: rgba(0, 0, 0, 0.15);
    }

    /* General Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
      margin: 0;
      line-height: 1.6;
    }

    header {
      position: sticky;
      top: 0;
      background: var(--card);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      z-index: 999;
      transition: box-shadow 0.3s ease;
    }

    header.scrolled {
      box-shadow: 0 4px 12px var(--shadow);
    }

    header h1 {
      margin: 0;
      font-size: 24px;
      color: var(--primary);
    }

    .theme-btn {
      background: transparent;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: var(--text);
      transition: color 0.3s ease;
    }

    .theme-btn:hover {
      color: var(--primary);
    }

    main {
      max-width: 700px;
      margin: 20px auto;
      padding: 0 20px;
    }

    /* Form & Input Styles */
    label {
      font-weight: 600;
      margin-top: 15px;
      display: block;
      color: var(--text);
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--card);
      color: var(--text);
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
      background: var(--primary);
      color: white;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    /* Info Box */
    .info {
      background: var(--card);
      padding: 15px;
      margin-top: 20px;
      border-left: 5px solid var(--primary);
      border-radius: 8px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    /* --- Testimonial Chat Style --- */
    #testimoniContainer {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      height: 400px;
      /* Tinggi box testimoni */
      overflow: hidden;
      /* Sembunyikan bubble yang keluar box */
      position: relative;
      box-shadow: 0 4px 12px var(--shadow);
      border: 1px solid var(--border);
    }

    .testimonial-bubble {
      background-color: var(--primary);
      color: white;
      padding: 10px 15px;
      border-radius: 20px 20px 20px 5px;
      margin-bottom: 15px;
      max-width: 80%;
      align-self: flex-start;
      opacity: 0;
      animation: slideInUp 0.5s ease-out forwards, fadeOut 0.5s ease-in 10s forwards;
      /* Muncul, lalu hilang setelah 10 detik */
    }

    .testimonial-bubble b {
      display: block;
      font-size: 0.9em;
      opacity: 0.8;
    }

    @keyframes slideInUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
        height: 0;
        padding: 0;
        margin: 0;
        border: 0;
      }
    }

    /* Result Section */
    #hasil {
      margin-top: 30px;
      background: var(--card);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .qr-btn {
      margin-top: 15px;
      padding: 12px 20px;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      /* Ubah ke inline-block */
      width: calc(50% - 10px);
      /* Buat jadi 2 tombol per baris */
      font-weight: bold;
      transition: background-color 0.3s ease, transform 0.2s ease;
      color: white !important;
    }

    .qr-btn.upload {
      background: #28a745;
    }

    .qr-btn.status {
      background: #17a2b8;
    }

    .qr-btn:hover {
      opacity: 0.9;
    }

    hr {
      margin: 40px 0;
      border: 0;
      border-top: 1px solid var(--border);
    }

    h2 {
      color: var(--primary);
      margin-top: 30px;
      margin-bottom: 20px;
      text-align: center;
    }

    .section-container {
      background: var(--card);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--shadow);
      margin-top: 20px;
    }

    /* --- FAQ Section Style --- */
    .faq-item {
      border-bottom: 1px solid var(--border);
      padding: 15px 0;
    }

    .faq-item:last-child {
      border-bottom: none;
    }

    .faq-question {
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .faq-question::after {
      content: 'â–¼';
      font-size: 12px;
      transition: transform 0.3s ease;
    }

    .faq-answer {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding-top 0.3s ease;
      padding-top: 0;
    }

    .faq-item.active .faq-answer {
      padding-top: 15px;
      max-height: 200px;
      /* Sesuaikan jika jawaban lebih panjang */
    }

    .faq-item.active .faq-question::after {
      transform: rotate(180deg);
    }
  </style>
</head>

<body data-theme="light">
  <header id="header">
    <h1>Asdar Store Digital</h1>
    <button class="theme-btn" onclick="toggleTheme()" id="themeToggle">ðŸŒ™</button>
  </header>

  <main id="main-content">
    <div data-aos="fade-up" class="section-container">
      <form id="formPesanan">
        <label for="nama">Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Cth: Budi Santoso" required />
        <label for="nomor">Nomor HP / ID Game</label>
        <input type="text" id="nomor" placeholder="Cth: 081234567890 atau ID Game Anda" required />
        <label for="waAktif">Nomor WhatsApp Aktif</label>
        <input type="tel" id="waAktif" placeholder="Cth: 081234567890" pattern="^(08|62)[0-9]{8,15}$" required />
        <label for="kategori">Kategori Produk</label>
        <select id="kategori" required>
          <option value="">Pilih Kategori</option>
        </select>
        <label for="produk">Produk</label>
        <select id="produk" required>
          <option value="">Pilih Produk</option>
        </select>
        <div class="info" id="infoProduk">Harga dan deskripsi akan muncul di sini.</div>
        <button type="submit">Pesan Sekarang</button>
      </form>
    </div>

    <div id="hasil" style="display: none;"></div>
    <hr>

    <div data-aos="fade-up">
      <h2>Testimoni Pelanggan Kami</h2>
      <div id="testimoniContainer">
      </div>
    </div>

    <div data-aos="fade-up" class="section-container">
      <h2>Beri Kami Testimoni</h2>
      <form id="formTestimoni">
        <label for="testiNama">Nama Anda</label>
        <input type="text" id="testiNama" placeholder="Nama Anda" required>
        <label for="testiPesan">Pesan Anda</label>
        <textarea id="testiPesan" rows="4" placeholder="Bagaimana pengalaman Anda berbelanja di sini?" required></textarea>
        <button type="submit">Kirim Testimoni</button>
        <p id="testiStatus" style="text-align:center; margin-top:10px;"></p>
      </form>
    </div>

    <hr>

    <div data-aos="fade-up">
      <h2>Ada Pertanyaan?</h2>
      <div class="section-container" id="faq-container">
      </div>
    </div>

    <hr>

    <div data-aos="fade-up" class="section-container">
      <h2>Cek Status Pesanan Anda</h2>
      <form onsubmit="event.preventDefault(); cekStatus();">
        <label for="idCek">Masukkan ID Pesanan</label>
        <input type="text" id="idCek" placeholder="Cth: P16789..." required />
        <button type="submit">Cek Status</button>
      </form>
    </div>

    <div id="dynamic-content-area" style="margin-top: 20px;"></div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    // Inisialisasi AOS (Animasi)
    AOS.init({
      duration: 800, // Durasi animasi
      once: true, // Animasi hanya terjadi sekali
      offset: 50, // Memicu animasi sedikit lebih awal
    });

    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const functions = firebase.functions();

    const ADMIN_WA_NUMBER = "6281803004607";
    const ADMIN_PANEL_LINK = "https://asdarcell.github.io/Asdarstoredigital/admin.html";

    const kategoriSelect = document.getElementById('kategori');
    const produkSelect = document.getElementById('produk');
    const infoProduk = document.getElementById('infoProduk');
    const hasilDiv = document.getElementById('hasil');

    const formatRupiah = (angka) => angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    const normalizePhone = (num) => {
      if (!num) return '';
      let n = String(num).replace(/[^0-9]/g, '');
      if (n.startsWith('0')) n = '62' + n.slice(1);
      return n;
    };
    window.toggleTheme = () => {
      const theme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', theme);
      document.getElementById('themeToggle').textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', theme);
    };
    if (localStorage.getItem('theme')) {
      document.body.setAttribute('data-theme', localStorage.getItem('theme'));
      document.getElementById('themeToggle').textContent = localStorage.getItem('theme') === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
    }

    // Efek shadow pada header saat scroll
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (window.scrollY > 10) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });

    async function sendWhatsApp(to, message) {
      try {
        const sendWaMessage = functions.httpsCallable('sendWaMessage');
        await sendWaMessage({
          to,
          message
        });
      } catch (error) {
        console.error("Gagal memanggil Cloud Function:", error);
      }
    }

    db.ref('produk').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      kategoriSelect.innerHTML = '<option value="">Pilih Kategori</option>';
      for (let kategori in data) {
        kategoriSelect.innerHTML += `<option value="${kategori}">${kategori}</option>`;
      }
    });

    kategoriSelect.addEventListener('change', () => {
      produkSelect.innerHTML = '<option value="">Pilih Produk</option>';
      infoProduk.innerHTML = 'Harga dan deskripsi akan muncul di sini.';
      const kategori = kategoriSelect.value;
      if (!kategori) return;
      db.ref(`produk/${kategori}`).once('value').then(snapshot => {
        const data = snapshot.val() || {};
        for (let nama in data) {
          produkSelect.innerHTML += `<option value="${nama}">${nama}</option>`;
        }
      });
    });

    produkSelect.addEventListener('change', () => {
      const kategori = kategoriSelect.value;
      const produk = produkSelect.value;
      if (!produk || !kategori) return;
      db.ref(`produk/${kategori}/${produk}`).once('value').then(snapshot => {
        const data = snapshot.val();
        if (data) {
          infoProduk.innerHTML = `<b>Harga:</b> Rp${formatRupiah(data.harga)}<br><b>Deskripsi:</b> ${data.deskripsi || data.cara || '-'}`;
        }
      });
    });

    document.getElementById('formPesanan').addEventListener('submit', async e => {
      e.preventDefault();
      const nama = document.getElementById('nama').value.trim();
      const nomor = document.getElementById('nomor').value.trim();
      const waAktif = normalizePhone(document.getElementById('waAktif').value.trim());
      const kategori = kategoriSelect.value;
      const produk = produkSelect.value;
      const waktu = new Date().toISOString();
      const id = "P" + Date.now();

      if (!nama || !nomor || !waAktif || !kategori || !produk) return alert("Harap lengkapi semua field!");

      try {
        const snapProduk = await db.ref(`produk/${kategori}/${produk}`).once('value');
        const dataProduk = snapProduk.val();
        if (!dataProduk) return alert("Produk tidak valid.");
        const harga = dataProduk.harga || 0;

        await db.ref('pesanan/' + id).set({
          nama,
          nomor,
          kategori,
          produk,
          harga,
          waktu,
          wa_aktif: waAktif,
          status: 'Belum Bayar'
        });

        hasilDiv.style.display = 'block';
        hasilDiv.innerHTML = `
                <p class="text-success fw-bold">âœ… Pesanan Anda berhasil dibuat!</p>
                <p><b>ID Pesanan Anda:</b> <code>${id}</code></p>
                <div class="info">
                    <p><strong>Silakan lakukan pembayaran sejumlah Rp${formatRupiah(harga)}</strong> ke salah satu tujuan berikut:</p>
                    <ul class="list-unstyled">
                        <li><strong>ShopeePay:</strong> 081803004607</li>
                        <li><strong>Dana:</strong> 087755432880</li>
                    </ul>
                </div>
                <a class='qr-btn upload' href="uplod.html?id=${id}">ðŸ“¤ Upload Bukti</a>
                <a class='qr-btn status' href="status.html?id=${id}">ðŸ“„ Cek Status</a>
                `;
        document.getElementById('formPesanan').reset();
        window.scrollTo(0, document.getElementById('hasil').offsetTop); // Scroll ke hasil

        const pesanAdmin = `ðŸ“¦ Pesanan Baru!\n\nID: *${id}*\nNama: ${nama}\nWA: ${waAktif}\nProduk: ${produk}\nHarga: Rp${formatRupiah(harga)}\n\nCek di Admin Panel:\n${ADMIN_PANEL_LINK}`;
        await sendWhatsApp(ADMIN_WA_NUMBER, pesanAdmin);
        alert("Pesanan berhasil dibuat!");
      } catch (error) {
        console.error("Error:", error);
        alert("Terjadi kesalahan.");
      }
    });

    window.cekStatus = () => {
      const id = document.getElementById('idCek').value.trim();
      if (id) window.location.href = `status.html?id=${id}`;
      else alert("Masukkan ID Pesanan.");
    };

    // --- Logika Testimoni Baru ---
    const testimoniContainer = document.getElementById('testimoniContainer');
    let testimoniDijalankan = false;

    function tampilkanSatuTesti(testimoni) {
      const bubble = document.createElement('div');
      bubble.className = 'testimonial-bubble';
      bubble.innerHTML = `<b>${testimoni.nama || 'Anonim'}</b> ${testimoni.pesan || ''}`;

      // Tambahkan bubble ke container
      testimoniContainer.appendChild(bubble);

      // Hapus bubble setelah animasinya selesai agar tidak menumpuk
      setTimeout(() => {
        if (bubble.parentElement) {
          testimoniContainer.removeChild(bubble);
        }
      }, 10500); // Waktu animasi fadeOut + sedikit buffer

      // Jaga agar container scroll ke bawah saat ada bubble baru
      testimoniContainer.scrollTop = testimoniContainer.scrollHeight;
    }

    db.ref('testimoni').on('value', snap => {
      const dataTesti = Object.values(snap.val() || {});
      if (dataTesti.length > 0 && !testimoniDijalankan) {
        testimoniDijalankan = true;
        let i = 0;
        // Tampilkan testimoni secara berkala
        setInterval(() => {
          tampilkanSatuTesti(dataTesti[i]);
          i = (i + 1) % dataTesti.length; // Ulang dari awal jika sudah habis
        }, 3000); // Tampilkan testimoni baru setiap 3 detik
      } else if (dataTesti.length === 0) {
        testimoniContainer.innerHTML = `<p style="text-align:center;">Belum ada testimoni. Jadilah yang pertama!</p>`;
      }
    });

    document.getElementById('formTestimoni').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nama = document.getElementById('testiNama').value.trim();
      const pesan = document.getElementById('testiPesan').value.trim();
      const statusEl = document.getElementById('testiStatus');

      if (!nama || !pesan) {
        statusEl.textContent = 'Nama dan pesan tidak boleh kosong!';
        statusEl.style.color = 'red';
        return;
      }

      try {
        // Simpan ke 'testimoni_pending' untuk dimoderasi Admin
        await db.ref('testimoni_pending').push({
          nama: nama,
          pesan: pesan,
          waktu: new Date().toISOString()
        });

        statusEl.textContent = 'Terima kasih! Testimoni Anda akan kami review.';
        statusEl.style.color = 'green';
        document.getElementById('formTestimoni').reset();
      } catch (error) {
        statusEl.textContent = 'Gagal mengirim testimoni. Coba lagi.';
        statusEl.style.color = 'red';
        console.error('Error kirim testimoni:', error);
      }
    });


    // --- Logika FAQ ---
    const faqData = [{
      q: "Bagaimana cara memesan?",
      a: "Pilih kategori dan produk yang Anda inginkan, isi data diri, lalu klik 'Pesan Sekarang'. Lakukan pembayaran sesuai instruksi dan unggah bukti bayar."
    }, {
      q: "Apa saja metode pembayaran yang diterima?",
      a: "Saat ini kami menerima pembayaran melalui ShopeePay dan Dana. Nomor tujuan pembayaran akan muncul setelah Anda membuat pesanan."
    }, {
      q: "Berapa lama prosesnya?",
      a: "Setelah Anda mengunggah bukti bayar dan kami verifikasi, pesanan akan diproses secepatnya, biasanya dalam 5-15 menit pada jam kerja."
    }, {
      q: "Apakah transaksi di sini aman?",
      a: "Sangat aman. Kami menjamin kerahasiaan data Anda dan keamanan transaksi. Anda juga bisa mengecek status pesanan kapan saja."
    }];

    const faqContainer = document.getElementById('faq-container');
    faqData.forEach(item => {
      const faqItem = document.createElement('div');
      faqItem.className = 'faq-item';
      faqItem.innerHTML = `
            <div class="faq-question">${item.q}</div>
            <div class="faq-answer">${item.a}</div>
            `;
      faqContainer.appendChild(faqItem);
    });

    document.querySelectorAll('.faq-question').forEach(item => {
      item.addEventListener('click', () => {
        // Tutup semua item lain sebelum membuka yang ini
        document.querySelectorAll('.faq-item').forEach(el => {
          if (el !== item.parentElement && el.classList.contains('active')) {
            el.classList.remove('active');
          }
        });
        // Buka/tutup item yang di-klik
        item.parentElement.classList.toggle('active');
      });
    });

    // --- Konten Dinamis dari Admin (jika ada) ---
    db.ref('dynamicContent/index').once('value').then(snapshot => {
      const konten = snapshot.val() || {};
      if (konten.css) {
        const styleTag = document.createElement('style');
        styleTag.textContent = konten.css;
        document.head.appendChild(styleTag);
      }
      if (konten.html) {
        document.getElementById('dynamic-content-area').innerHTML = konten.html;
      }
      if (konten.js) {
        const scriptTag = document.createElement('script');
        scriptTag.textContent = konten.js;
        document.body.appendChild(scriptTag);
      }
    });
  </script>
</body>

</html>
