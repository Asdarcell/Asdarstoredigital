<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asdar Store Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: linear-gradient(to right, #e8f0ff, #ffffff); color: #333; padding: 16px; }
        header { text-align: center; padding: 30px 16px; background: #007BFF; color: white; border-radius: 16px; margin-bottom: 24px; }
        header h1 { font-size: 2.4em; margin-bottom: 10px; }
        header p { font-size: 1.1em; color: #e0eaff; }
        .card { background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); margin-bottom: 24px; transition: 0.3s ease; }
        .card:hover { transform: scale(1.01); }
        .card h2 { font-size: 1.4em; margin-bottom: 12px; color: #007BFF; border-bottom: 1px solid #ddd; padding-bottom: 6px; }
        .btn { background: #007BFF; color: white; padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; margin-top: 14px; transition: background 0.3s ease; }
        .btn:hover { background: #0056b3; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 10px; border: 1px solid #ccc; border-radius: 10px; font-size: 1em; }
        #previewImage { margin-top: 10px; max-width: 100%; border-radius: 10px; box-shadow: 0 0 6px rgba(0,0,0,0.1); }
        .payment-box { background: #eef3ff; padding: 14px; border-radius: 12px; text-align: center; font-weight: bold; color: #333; line-height: 1.6; margin-top: 16px; }
        footer { text-align: center; margin-top: 40px; color: #777; font-size: 0.9em; }
        .testimoni-container { background: #f4f8ff; border-radius: 10px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .testimoni-item { background: #dce8ff; color: #222; padding: 10px 14px; border-radius: 8px; margin-bottom: 8px; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<header>
    <h1>Asdar Store Digital</h1>
    <p>💎 Cepat · Aman · Terpercaya 💎</p>
</header>

<section class="card">
    <h2>🛒 Pilih Produk</h2>
    <select id="kategoriProduk" onchange="updateVarian()">
        <option value="">Pilih kategori...</option>
        <option value="kvision">K-Vision</option>
        <option value="nex">Nex Parabola</option>
        <option value="mnc">MNC Vision</option>
    </select>
    <select id="varianProduk"><option value="">Pilih paket...</option></select>
    <input type="text" id="nomorHP" placeholder="Nomor HP Anda (opsional)" />
    <button class="btn" onclick="pesanSekarang()">Pesan Sekarang</button>
</section>

<section class="card" id="uploadSection" style="display:none;">
    <h2>📤 Upload Bukti Pembayaran</h2>
    <input type="file" id="buktiBayar" accept="image/*" onchange="previewImage(event)" />
    <img id="previewImage" />
    <div class="payment-box">
        🟣 <b>PAYMENT</b> 🟣<br/>
        ShopeePay: <b>081803004607</b><br/>
        DANA: <b>087755432880</b>
    </div>
    <button class="btn" onclick="uploadGambar()">Kirim ke WhatsApp</button>
</section>

<section class="card">
    <h2>💬 Testimoni Pelanggan</h2>
    <input type="text" id="namaTesti" placeholder="Nama Anda (contoh: Budi)" />
    <textarea id="inputTesti" placeholder="Tulis testimoni Anda..."></textarea>
    <button class="btn" onclick="kirimTestimoni()">Kirim Testimoni</button>
    <div class="testimoni-container" id="testimoniContainer"></div>
</section>

<footer>
    &copy; 2025 Asdar Store Digital · All Rights Reserved
</footer>

<!-- Firebase & Script -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
        authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
        databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
        projectId: "asdarstoredigitalll-d89c4",
        storageBucket: "asdarstoredigitalll-d89c4.appspot.com",
        messagingSenderId: "220670500351",
        appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const testimoniNegatif = ["jelek", "penipu", "bohong", "gagal", "tidak sesuai", "buruk"];
    const hargaProduk = {
        "K-Vision|Cling 30 Hari": 30000,
        "K-Vision|Liga 1": 35000,
        "K-Vision|Timnas": 30000,
        "K-Vision|Paket Film": 40000,
        "Nex Parabola|Basic 30 Hari": 35000,
        "Nex Parabola|Basic 90 Hari": 90000,
        "MNC Vision|Jawara 30 Hari": 40000,
        "MNC Vision|Timnas": 35000
    }; 

    const testimoniDefault = [
        { nama: "Rina", isi: "Pelayanan cepat dan ramah, top!" },
        { nama: "Agus", isi: "Transaksi aman, produk langsung aktif!" },
        { nama: "Dewi", isi: "Terpercaya banget, langganan terus!" }
    ]; 

    let indexTesti = 0; 
    window.addEventListener("DOMContentLoaded", () => {
        tampilkanTestimoniDefault();
        muatTestimoniDariFirebase();
    });

    function tampilkanTestimoniDefault() {
        const container = document.getElementById("testimoniContainer");
        setInterval(() => {
            const testi = testimoniDefault[indexTesti];
            const div = document.createElement("div");
            div.className = "testimoni-item";
            div.textContent = `${testi.nama}: ${testi.isi}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            indexTesti++;
            if (indexTesti >= testimoniDefault.length) indexTesti = 0;
        }, 3000);
    }

    function muatTestimoniDariFirebase() {
        const container = document.getElementById("testimoniContainer");
        db.ref("testimoni").limitToLast(20).on("child_added", snapshot => {
            const data = snapshot.val();
            const div = document.createElement("div");
            div.className = "testimoni-item";
            div.textContent = `${data.nama}: ${data.isi}`;
            container.prepend(div);
        });
    }

    function kirimTestimoni() {
        const nama = document.getElementById("namaTesti").value.trim();
        const isi = document.getElementById("inputTesti").value.trim();
        if (!nama || !isi) return alert("Isi nama dan testimoni terlebih dahulu.");
        if (!/^[a-zA-Z\s]+$/.test(nama)) return alert("Nama hanya boleh huruf.");
        const dilarang = testimoniNegatif.some(kata => isi.toLowerCase().includes(kata));
        if (dilarang) return alert("Testimoni mengandung kata negatif ❗");
        
        db.ref("testimoni").push({ nama, isi });
        const container = document.getElementById("testimoniContainer");
        const div = document.createElement("div");
        div.className = "testimoni-item";
        div.textContent = `${nama}: ${isi}`;
        container.prepend(div);
        document.getElementById("namaTesti").value = "";
        document.getElementById("inputTesti").value = "";
    }

    function updateVarian() {
        const varian = document.getElementById("varianProduk");
        const kategori = document.getElementById("kategoriProduk").value;
        varian.innerHTML = "";
        let opsi = [];
        if (kategori === "kvision") opsi = ["Cling 30 Hari", "Liga 1", "Timnas", "Paket Film"];
        if (kategori === "nex") opsi = ["Basic 30 Hari", "Basic 90 Hari"];
        if (kategori === "mnc") opsi = ["Jawara 30 Hari", "Timnas"];
        opsi.forEach(v => {
            const opt = document.createElement("option");
            opt.value = v;
            opt.textContent = v;
            varian.appendChild(opt);
        });
    }

    let hargaTerpilih = 0;
    let produkTerpilih = "";

    function pesanSekarang() {
        const kategori = document.getElementById("kategoriProduk").value;
        const varian = document.getElementById("varianProduk").value;
        const nomorHP = document.getElementById("nomorHP").value.trim();
        if (!kategori || !varian) return alert("Pilih kategori dan varian terlebih dahulu.");

        const namaKategori = kategori === "kvision" ? "K-Vision" : kategori === "nex" ? "Nex Parabola" : "MNC Vision";
        const key = `${namaKategori}|${varian}`;
        const harga = hargaProduk[key] || 0;
        if (harga === 0) return alert("Harga belum tersedia.");

        produkTerpilih = `${namaKategori} - ${varian}`;
        hargaTerpilih = harga;

        // Menyimpan data transaksi ke Firebase
        db.ref("transaksi").push({
            nama: document.getElementById("nomorHP").value,
            produkNama: produkTerpilih,
            idpel: nomorHP,
            harga: hargaTerpilih,
            status: "Pending",
            buktiBayarUrl: null // Akan diperbarui saat upload
        });

        let pesan = `💰 Silakan bayar Rp${harga.toLocaleString()} ke DANA 087755432880.`;
        if (nomorHP) {
            pesan += `\nNomor HP Anda: ${nomorHP}`;
        }
        pesan += `\nKemudian upload bukti pembayaran.`;

        alert(pesan);
        document.getElementById("uploadSection").style.display = "block";
        document.getElementById("uploadSection").scrollIntoView({ behavior: "smooth" });
    }

    function previewImage(event) {
        const image = document.getElementById('previewImage');
        image.src = URL.createObjectURL(event.target.files[0]);
    }

    function uploadGambar() {
        const file = document.getElementById("buktiBayar").files[0];
        if (!file) return alert("Upload gambar terlebih dahulu.");

        const formData = new FormData();
        formData.append("image", file);
        fetch("https://api.imgbb.com/1/upload?key=f71ccc1a662c9f8656766990018d3a33", {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            const linkGambar = data.data.url;

            // Update bukti bayar URL di transaksi
            db.ref("transaksi").orderByChild("produkNama").equalTo(produkTerpilih).once("value", snapshot => {
                snapshot.forEach(childSnapshot => {
                    const key = childSnapshot.key;
                    db.ref("transaksi/" + key).update({ buktiBayarUrl: linkGambar });
                });
            });

            const pesan = `Halo Admin, saya sudah bayar sebesar Rp${hargaTerpilih.toLocaleString()} untuk ${produkTerpilih}. Berikut bukti pembayaran:\n${linkGambar}`;
            const nomorWA = "081803004607";
            window.open(`https://wa.me/${nomorWA}?text=${encodeURIComponent(pesan)}`, "_blank");
        })
        .catch(() => alert("❌ Gagal upload gambar."));
    }
</script>
</body>
</html>
