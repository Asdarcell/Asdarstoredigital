<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asdar Store Digital</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f4f4;
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .qr-btn {
      display: block;
      margin-top: 10px;
      background: #3498db;
      color: white;
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      text-decoration: none;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="text-center mb-4">Pesan Produk Digital</h2>
  <form id="formPesanan">
    <div class="mb-3">
      <label>Nama Lengkap</label>
      <input type="text" id="nama" class="form-control" required />
    </div>
    <div class="mb-3">
      <label>Nomor HP / ID SN</label>
      <input type="text" id="nomor" class="form-control" required />
    </div>
    <div class="mb-3">
      <label>Kategori Produk</label>
      <select id="kategori" class="form-control" required><option value="">Pilih Kategori</option></select>
    </div>
    <div class="mb-3">
      <label>Produk</label>
      <select id="produk" class="form-control" required><option value="">Pilih Produk</option></select>
    </div>
    <div class="alert alert-info" id="infoProduk">Harga & deskripsi akan tampil di sini.</div>
    <button class="btn btn-primary w-100" type="submit">Pesan Sekarang</button>
  </form>
  <div id="hasil" class="mt-3"></div>
</div><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script><script>
const firebaseConfig = {
  apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
  authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
  databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
  projectId: "asdarstoredigitalll-d89c4",
  storageBucket: "asdarstoredigitalll.appspot.com",
  messagingSenderId: "220670500351",
  appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const kategoriSelect = document.getElementById('kategori');
const produkSelect = document.getElementById('produk');
const infoProduk = document.getElementById('infoProduk');
const hasil = document.getElementById('hasil');
const produkRef = db.ref('produk');

produkRef.once('value').then(snapshot => {
  const data = snapshot.val();
  for (let kategori in data) {
    kategoriSelect.innerHTML += `<option value="${kategori}">${kategori}</option>`;
  }
});

kategoriSelect.addEventListener('change', () => {
  produkSelect.innerHTML = '<option value="">Pilih Produk</option>';
  infoProduk.innerHTML = 'Harga & deskripsi akan tampil di sini.';
  const kategori = kategoriSelect.value;
  if (!kategori) return;
  produkRef.child(kategori).once('value').then(snapshot => {
    const data = snapshot.val();
    for (let nama in data) {
      produkSelect.innerHTML += `<option value="${nama}">${nama}</option>`;
    }
  });
});

produkSelect.addEventListener('change', () => {
  const kategori = kategoriSelect.value;
  const produk = produkSelect.value;
  if (!produk) return;
  produkRef.child(`${kategori}/${produk}`).once('value').then(snapshot => {
    const data = snapshot.val();
    infoProduk.innerHTML = `<b>Harga:</b> Rp${data.harga}<br><b>Deskripsi:</b> ${data.cara || data.deskripsi || ''}`;
  });
});

document.getElementById('formPesanan').addEventListener('submit', e => {
  e.preventDefault();
  const nama = document.getElementById('nama').value.trim();
  const nomor = document.getElementById('nomor').value.trim();
  const kategori = kategoriSelect.value;
  const produk = produkSelect.value;
  const waktu = new Date().toISOString();
  const id = "P" + Date.now();
  if (!nama || !nomor || !kategori || !produk) return alert("Harap lengkapi semua field!");
  produkRef.child(`${kategori}/${produk}`).once('value').then(snap => {
    const data = snap.val();
    const harga = data.harga || 0;
    db.ref('pesanan/' + id).set({ nama, nomor, kategori, produk, harga, waktu, status: 'Belum Bayar' }).then(() => {
      hasil.innerHTML = `
âœ… Pesanan Berhasil!<br><b>ID:</b> ${id}<br>
<div class='alert alert-warning mt-2'>Transfer ke Dana: <b>087755432880</b> atau ShopeePay: <b>081803004607</b></div>
<a class='qr-btn' href="upload.html?id=${id}">ðŸ“¤ Upload Bukti Bayar</a>
<a class='qr-btn bg-success" href="status.html?id=${id}">ðŸ“„ Cek Status</a>
`;
      document.getElementById('formPesanan').reset();
      infoProduk.innerHTML = 'Harga & deskripsi akan tampil di sini.';
    });
  });
});
</script></body>
</html>
