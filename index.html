<!-- index.html --><!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asdar Store Digital</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Asdar Store Digital</h1>
  </header>
  <main>
    <section id="produkList"></section>
  </main>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  <script src="firebase-config.js"></script>  <script>
    const produkList = document.getElementById('produkList');
    const dbRef = firebase.database().ref('produk');
    dbRef.on('value', snapshot => {
      produkList.innerHTML = '';
      snapshot.forEach(child => {
        const p = child.val();
        const div = document.createElement('div');
        div.className = 'produk';
        div.innerHTML = `
          <h3>${p.nama}</h3>
          <p>Harga: Rp${p.harga.toLocaleString()}</p>
          <button onclick="pesanProduk('${child.key}')">Pesan</button>
        `;
        produkList.appendChild(div);
      });
    });

    function pesanProduk(idProduk) {
      window.location.href = `transaksi.html?produk=${idProduk}`;
    }
  </script></body>
</html><!-- transaksi.html --><!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transaksi Pembeli</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h2>Transaksi Pembeli</h2>
  <form id="formTransaksi">
    <input type="text" id="nama" placeholder="Nama" required />
    <input type="text" id="nomor" placeholder="Nomor HP" required />
    <input type="text" id="idproduk" placeholder="ID/SN/Nomor Tujuan" required />
    <p>Total Bayar: <span id="totalBayar">...</span></p>
    <button type="submit">Kirim Pesanan</button>
  </form>
  <form id="uploadBukti">
    <input type="file" id="bukti" accept="image/*" required />
    <button type="submit">Upload Bukti Bayar</button>
  </form>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>  <script src="firebase-config.js"></script>  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const idProduk = urlParams.get('produk');
    const dbRef = firebase.database().ref('produk/' + idProduk);
    let harga = 0;

    dbRef.once('value').then(snap => {
      const p = snap.val();
      harga = parseInt(p.harga) + 3000; // otomatis tambah ongkos admin
      document.getElementById('totalBayar').innerText = 'Rp' + harga.toLocaleString();
    });

    document.getElementById('formTransaksi').addEventListener('submit', function(e) {
      e.preventDefault();
      const nama = document.getElementById('nama').value;
      const nomor = document.getElementById('nomor').value;
      const tujuan = document.getElementById('idproduk').value;

      const id = Date.now();
      firebase.database().ref('pesanan/' + id).set({
        nama, nomor, produk: idProduk, tujuan,
        harga, status: 'Menunggu Verifikasi', waktu: new Date().toISOString()
      }).then(() => alert('Pesanan terkirim!'));
    });

    document.getElementById('uploadBukti').addEventListener('submit', function(e) {
      e.preventDefault();
      const file = document.getElementById('bukti').files[0];
      const ref = firebase.storage().ref('bukti_bayar/' + Date.now());
      ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
        firebase.database().ref('pesanan').orderByChild('nomor').equalTo(document.getElementById('nomor').value).once('value', snap => {
          snap.forEach(data => {
            firebase.database().ref('pesanan/' + data.key).update({ bukti_bayar: url });
          });
        });
        alert('Bukti bayar terkirim!');
      });
    });
  </script></body>
</html>
