<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asdar Store Digital</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f1f7ff;
      margin: 0; padding: 0 20px 40px;
      color: #333;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #007BFF;
      color: white;
      padding: 15px 20px;
      border-radius: 0 0 12px 12px;
      margin-bottom: 20px;
    }
    header .logo {
      font-weight: 700;
      font-size: 1.5em;
      letter-spacing: 2px;
      cursor: default;
      user-select: none;
    }
    header .kontak-wa {
      display: flex;
      gap: 15px;
      font-weight: 600;
      font-size: 0.9em;
    }
    header .kontak-wa a {
      color: #f1f7ff;
      text-decoration: none;
      background: #0056b3;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }
    header .kontak-wa a:hover {
      background: #003d7a;
    }
    h2 {
      color: #007BFF;
      margin-top: 0;
      margin-bottom: 15px;
      text-align: center;
      user-select: none;
    }
    /* Filter */
    #filterKategori {
      max-width: 300px;
      margin: 0 auto 25px auto;
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
      display: block;
      cursor: pointer;
    }

    /* Produk Card */
    .produk-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .produk-card h3 {
      margin-top: 0;
      user-select: none;
    }
    .produk-card p, .produk-card small {
      margin: 5px 0;
    }
    .produk-card select, .produk-card button, .produk-card input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .produk-card button {
      background: #28a745;
      color: white;
      border: none;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .produk-card button:hover {
      background: #218838;
      cursor: pointer;
    }
    /* Preview gambar bukti */
    .preview-img {
      margin-top: 10px;
      max-width: 100%;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    /* Testimoni Section */
    #testimoniSection {
      margin-top: 40px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    #testimoniSection h2 {
      margin-bottom: 20px;
    }
    form#formTestimoni {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    form#formTestimoni label {
      display: block;
      margin: 10px 0 5px;
      font-weight: 600;
    }
    form#formTestimoni input[type="text"],
    form#formTestimoni textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      box-sizing: border-box;
    }
    form#formTestimoni button {
      margin-top: 15px;
      background: #007BFF;
      color: white;
      font-weight: 700;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    form#formTestimoni button:hover {
      background: #0056b3;
    }
    /* Daftar Testimoni */
    #daftarTestimoni {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-height: 350px;
      overflow-y: auto;
    }
    .testi-item {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }
    .testi-item:last-child {
      border-bottom: none;
    }
    .testi-item strong {
      color: #007BFF;
      user-select: none;
    }
    .testi-item p {
      margin: 5px 0 0;
    }

  </style>
</head>
<body>

  <header>
    <div class="logo">Asdar Store Digital</div>
    <div class="kontak-wa">
      <a href="tel:081803004607">üìû 0818-0300-4607</a>
      <a href="https://wa.me/6281803004607" target="_blank" rel="noopener">üí¨ Chat WA</a>
      <a href="https://chat.whatsapp.com/channel/0029Vb62LLQ8fewkIbRimi1h" target="_blank" rel="noopener">üì¢ Channel WA</a>
    </div>
  </header>

  <h2>üè≠Ô∏è Daftar Produk</h2>

  <select id="filterKategori" title="Filter kategori produk">
    <option value="semua">-- Semua Kategori --</option>
  </select>

  <div id="produkList"></div>

  <section id="testimoniSection">
    <h2>üó£Ô∏è Berikan Testimoni Kamu</h2>
    <form id="formTestimoni">
      <label for="namaTesti">Nama</label>
      <input type="text" id="namaTesti" placeholder="Nama kamu" required />

      <label for="isiTesti">Testimoni</label>
      <textarea id="isiTesti" rows="4" placeholder="Tulis testimoni kamu di sini..." required></textarea>

      <button type="submit">Kirim Testimoni</button>
    </form>

    <div id="daftarTestimoni">
      <!-- Testimoni akan muncul di sini -->
    </div>
  </section>

  <script>
    // Data Produk
    const produkData = [
      { kategori: 'K-Vision', nama: 'K-Vision CLING', varian: ['1 Bulan - 39.000', '3 Bulan - 110.000'], base: 39000 },
      { kategori: 'Nex Parabola', nama: 'Nex Basic', varian: ['30 Hari - 29.000', '360 Hari - 290.000'], base: 29000 },
      { kategori: 'MNC Vision', nama: 'Paket Jawara', varian: ['1 Bulan - 60.000', '12 Bulan - 700.000'], base: 60000 },
      { kategori: 'XL', nama: 'XL Unlimited', varian: ['TikTok + Semua Aplikasi - 80.000', 'Tanpa TikTok - 75.000'], base: 80000 },
      { kategori: 'PLN', nama: 'Token Listrik', varian: ['20.000 - Rp23.000', '50.000 - Rp53.000', '100.000 - Rp103.000'], base: 23000 }
    ];

    const waTujuan = "6281803004607";
    const produkList = document.getElementById('produkList');
    const filterKategori = document.getElementById('filterKategori');

    // Untuk testimoni sederhana, simpan di localStorage
    const testiKey = 'asdarstore_testimoni';
    let testimoni = JSON.parse(localStorage.getItem(testiKey)) || [];

    // Fungsi render produk sesuai filter
    function renderProduk(filter = 'semua') {
      produkList.innerHTML = '';
      let filtered = produkData;
      if(filter !== 'semua') {
        filtered = produkData.filter(p => p.kategori === filter);
      }
      filtered.forEach((p, i) => {
        const varianId = `varian-${i}`;
        const div = document.createElement('div');
        div.className = 'produk-card';
        div.dataset.kategori = p.kategori;

        div.innerHTML = `
          <h3>${p.nama}</h3>
          <p><strong>Kategori:</strong> ${p.kategori}</p>
          <select id="${varianId}">
            ${p.varian.map(v => `<option value="${v}">${v}</option>`).join('')}
          </select>

          <label for="buktiBayar-${i}">Upload Bukti Pembayaran (opsional):</label>
          <input type="file" id="buktiBayar-${i}" accept="image/*" />

          <img id="previewBukti-${i}" class="preview-img" style="display:none;" alt="Preview Bukti" />

          <p><strong>Total:</strong> Rp${(p.base + 3000).toLocaleString()} (sudah termasuk admin Rp3.000)</p>
          <small>Transfer ke ShopeePay: 081803004607 / DANA: 087755432880</small>
          <button onclick="pesanWA('${p.nama}', '${varianId}', ${p.base + 3000}, ${i})">‚úÖ Saya Sudah Bayar</button>
        `;

        produkList.appendChild(div);

        // Tambah event preview gambar bukti bayar
        const inputFile = document.getElementById(`buktiBayar-${i}`);
        const previewImg = document.getElementById(`previewBukti-${i}`);
        inputFile.addEventListener('change', () => {
          const file = inputFile.files[0];
          if(file) {
            const reader = new FileReader();
            reader.onload = e => {
              previewImg.src = e.target.result;
              previewImg.style.display = 'block';
            };
            reader.readAsDataURL(file);
          } else {
            previewImg.src = '';
            previewImg.style.display = 'none';
          }
        });
      });
    }

    // Fungsi mengirim pesan WA
    function pesanWA(namaProduk, varianId, total, index) {
      const varian = document.getElementById(varianId).value;
      const inputFile = document.getElementById(`buktiBayar-${index}`);
      let pesan = `Halo kak, saya sudah transfer.%0AProduk: ${namaProduk}%0AVarian: ${varian}%0ATotal: Rp${total.toLocaleString()}%0A`;

      if(inputFile.files.length > 0) {
        // Karena WA Web tidak bisa kirim file langsung lewat URL, kita hanya kirim pesan bahwa sudah upload bukti.
        pesan += 'Saya sudah upload bukti pembayaran (gambar). Mohon segera diproses ya üôè';
        alert("Untuk upload bukti gambar, silakan kirim manual lewat chat WhatsApp karena WhatsApp Web tidak bisa kirim file otomatis dari browser.");
      } else {
        pesan += 'Mohon segera diproses ya üôè';
      }

      const link = `https://wa.me/${waTujuan}?text=${pesan}`;
      window.open(link, '_blank');
    }

    // Render filter kategori unik otomatis
    function renderFilterKategori() {
      const kategoriSet = new Set(produkData.map(p => p.kategori));
      kategoriSet.forEach(kat => {
        const option = document.createElement('option');
        option.value = kat;
        option.textContent = kat;
        filterKategori.appendChild(option);
      });
    }

    // Fungsi render testimoni ke DOM
    function renderTestimoni() {
      const daftar = document.getElementById('daftarTestimoni');
      if(testimoni.length === 0) {
        daftar.innerHTML = '<p>Belum ada testimoni.</p>';
        return;
      }
      daftar.innerHTML = testimoni.map(t => `
        <div class="testi-item">
          <strong>${escapeHtml(t.nama)}</strong>
          <p>${escapeHtml(t.isi)}</p>
        </div>
      `).join('');
    }

    // Escape HTML untuk keamanan
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Simpan testimoni ke localStorage
    function tambahTestimoni(nama, isi) {
      // Cek testimoni negatif (kata kasar atau negatif) - tolak jika ada
      const kataNegatif = ['jelek','buruk','tidak puas','pelayanan jelek','nggak bagus','mengecewakan'];
      const teksLower = isi.toLowerCase();
      for(let kata of kataNegatif){
        if(teksLower.includes(kata)) {
          alert("Testimoni mengandung kata negatif dan tidak dapat diterima.");
          return false;
        }
      }

      testimoni.push({nama, isi});
      localStorage.setItem(testiKey, JSON.stringify(testimoni));
      return true;
    }

    // Event submit testimoni
    document.getElementById('formTestimoni').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaTesti').value.trim();
      const isi = document.getElementById('isiTesti').value.trim();
      if(nama === '' || isi === '') {
        alert("Mohon isi nama dan testimoni.");
        return;
      }

      if(tambahTestimoni(nama, isi)) {
        alert("Terima kasih sudah mengirim testimoni!");
        document.getElementById('formTestimoni').reset();
        renderTestimoni();
      }
    });

    // Event filter kategori
    filterKategori.addEventListener('change', e => {
      renderProduk(e.target.value);
    });

    // Inisialisasi awal
    renderFilterKategori();
    renderProduk();
    renderTestimoni();

  </script>

</body>
</html>
