<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asdar Store Digital</title>
    <link rel="icon" href="https://placehold.co/32x32/007bff/ffffff?text=AS" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-body: #f7f9fc; --bg-card: #ffffff; --text-primary: #212529; --text-secondary: #6c757d;
            --color-brand: #007bff; --color-brand-hover: #0056b3; --border-color: #e0e0e0;
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.08); --focus-ring: rgba(0, 123, 255, 0.25);
            --primary-rgb: 0, 123, 255;
        }
        [data-theme="dark"] {
            --bg-body: #1a202c; --bg-card: #2d3748; --text-primary: #e2e8f0; --text-secondary: #a0aec0;
            --color-brand: #4fd1c5; --color-brand-hover: #38b2ac; --border-color: #4a5568;
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.4); --focus-ring: rgba(79, 209, 197, 0.35);
            --primary-rgb: 79, 209, 197;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-body); color: var(--text-primary); }
        header { background-color: var(--bg-card); border-bottom: 1px solid var(--border-color); box-shadow: var(--shadow-light); }
        header h1 { color: var(--color-brand); }
       .theme-toggle-btn:hover { color: var(--color-brand); }
        main { max-width: 600px; margin: auto; width: 100%; }
       .section-card { background-color: var(--bg-card); box-shadow: var(--shadow-light); }
       .section-card h2 { color: var(--color-brand); }
        input, select, textarea { border: 1px solid var(--border-color); background-color: var(--bg-card); color: var(--text-primary); }
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px;
        }
        [data-theme="dark"] select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23e2e8f0' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); }
        input:focus, select:focus, textarea:focus { border-color: var(--color-brand); box-shadow: 0 0 0 3px var(--focus-ring); }
        input:disabled, button:disabled, select:disabled { background-color: var(--bg-body)!important; cursor: not-allowed!important; opacity: 0.6; }
       .btn-primary { background-color: var(--color-brand); }
       .btn-primary:not(:disabled):hover { background-color: var(--color-brand-hover); }
       .accordion-item { border: 1px solid var(--border-color); background: var(--bg-card); }
       .accordion-content { border-top: 1px solid var(--border-color); background: var(--bg-card); }
       .product-item { border-bottom: 1px solid var(--border-color); }
       .product-item.price { color: var(--color-brand); }
       .product-item.selected { background-color: rgba(var(--primary-rgb), 0.1); border-left: 4px solid var(--color-brand); }
       .chat-container { border: 1px solid var(--border-color); background-color: var(--bg-body); }
       .chat-message.user { background-color: var(--color-brand); }
       .chat-message.bot { background-color: var(--border-color); color: var(--text-primary); }
        [data-theme="dark"].chat-message.bot { background-color: #4a5568; color: #e2e8f0; }
    </style>
</head>
<body class="p-6">
    <header class="p-4 flex justify-between items-center sticky top-0 z-10 rounded-xl mb-6">
        <h1 class="text-2xl font-bold">Asdar Store Digital</h1>
        <button class="theme-toggle-btn text-2xl" onclick="toggleTheme()" id="themeToggle">🌙</button>
    </header>

    <main>
        <div class="section-card p-6 rounded-xl mb-6">
            <h2 class="text-2xl font-bold text-center mb-4">Daftar Produk</h2>
            <div id="product-selection-flow">
                <label for="category-select" class="font-semibold">Langkah 1: Pilih Kategori Produk</label>
                <select id="category-select" class="w-full p-3 rounded-lg mt-2 mb-6">
                    <option value="" disabled selected>--- Memuat Kategori ---</option>
                </select>
                <div id="product-variants-container" style="display: none;">
                    <label class="font-semibold">Langkah 2: Pilih Varian Produk</label>
                    <div id="product-variants-accordion"></div>
                </div>
            </div>
        </div>

        <div class="section-card p-6 rounded-xl mb-6">
            <h2 class="text-2xl font-bold text-center mb-4">Detail Pemesanan</h2>
            <form id="orderForm">
                <label for="productName">Produk Dipilih</label>
                <input type="text" id="productName" class="w-full p-3 rounded-lg mt-1" readonly required />
                <label for="harga" class="mt-4">Harga</label>
                <input type="text" id="harga" class="w-full p-3 rounded-lg mt-1" readonly required />
                <label for="buyerName" class="mt-4">Nama Lengkap</label>
                <input type="text" id="buyerName" class="w-full p-3 rounded-lg mt-1" placeholder="Pilih produk terlebih dahulu" required disabled />
                <label for="nomor" class="mt-4">Nomor HP / ID SN Game</label>
                <input type="text" id="nomor" class="w-full p-3 rounded-lg mt-1" placeholder="Pilih produk terlebih dahulu" required disabled />
                <label for="buyerWa" class="mt-4">Nomor WhatsApp Aktif</label>
                <input type="tel" id="buyerWa" class="w-full p-3 rounded-lg mt-1" placeholder="Pilih produk terlebih dahulu" pattern="^(08|62)[0-9]{8,15}$" required disabled />
                <p class="text-xs text-text-secondary mt-1 mb-3">Gunakan format 08xxxxxxxxxx atau 62xxxxxxxxxx.</p>
                <h3 class="text-lg font-semibold text-center mt-6 mb-4">Metode Pembayaran Manual</h3>
                <div class="flex items-center gap-2 mb-4">
                    <input type="text" id="danaId" value="087755432880" class="w-full p-3 rounded-lg" readonly />
                    <button type="button" class="btn btn-primary" onclick="copyToClipboard('087755432880', this)"><i class="fas fa-copy"></i> Salin DANA</button>
                </div>
                <div class="flex items-center gap-2">
                    <input type="text" id="shopeepayId" value="081803004607" class="w-full p-3 rounded-lg" readonly />
                    <button type="button" class="btn btn-primary" onclick="copyToClipboard('081803004607', this)"><i class="fas fa-copy"></i> Salin ShopeePay</button>
                </div>
                <p class="text-sm text-red-500 mt-4 text-center">*PENTING:* Setelah transfer, segera <a href="./upload.html" class="font-semibold underline">unggah bukti pembayaran di sini</a>!</p>
                <button type="submit" class="btn btn-primary w-full mt-6" id="orderBtn" disabled><i class="fas fa-paper-plane"></i> Buat Pesanan</button>
            </form>
        </div>

        <div class="section-card p-6 rounded-xl mb-6">
            <h2 class="text-2xl font-bold text-center mb-4">Cek Status Pesanan</h2>
            <div class="flex items-center gap-2">
                <input type="text" id="orderIdCheck" placeholder="Masukkan ID Pesanan Anda" class="w-full p-3 rounded-lg" />
                <button type="button" class="btn btn-primary" onclick="checkOrderStatus()"><i class="fas fa-search"></i> Cek</button>
            </div>
        </div>

        <div class="section-card p-6 rounded-xl mb-6">
            <h2 class="text-2xl font-bold text-center mb-4">Tanya Jawab (Q&A)</h2>
            <div id="chat-box" class="chat-container h-72 p-4 rounded-lg flex flex-col gap-2 mb-4"></div>
            <div class="chat-input-group flex items-center gap-2">
                <input type="text" id="qaInput" placeholder="Ketik pertanyaan Anda..." class="w-full p-3 rounded-lg" />
                <button type="button" class="btn btn-primary" onclick="sendQuestion()"><i class="fas fa-comment-dots"></i></button>
            </div>
        </div>
        <div id="dynamic-content-area"></div>
    </main>
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center hidden"><div class="border-4 border-t-transparent border-white rounded-full w-10 h-10 animate-spin"></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // --- Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
            authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
            databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
            projectId: "asdarstoredigitalll-d89c4",
            storageBucket: "asdarstoredigitalll-d89c4.firebasestorage.app",
            messagingSenderId: "220670500351",
            appId: "1:220670500351:web:5737ae5958a6f5a67d5bca",
            measurementId: "G-CMRW37J19G"
        };
        const NGIRIMWA_APPKEY = "ab3727c5-e0be-40f9-bb3f-25d93b029f7a";
        const NGIRIMWA_AUTHKEY = "tbAWbiCwmK1H0IgWpkJFzwiv8yXMuenAyenek6rJBG8QEqyiqq";
        const ADMIN_WA_NUMBER = "6281803004607";

        // --- Init Firebase ---
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- DOM Elements ---
        const loadingOverlay = document.getElementById('loading-overlay');
        const orderForm = document.getElementById('orderForm');
        const categorySelect = document.getElementById('category-select');
        const productVariantsContainer = document.getElementById('product-variants-container');
        const productVariantsAccordionDiv = document.getElementById('product-variants-accordion');
        const productNameInput = document.getElementById('productName');
        const hargaInput = document.getElementById('harga');
        const buyerNameInput = document.getElementById('buyerName');
        const nomorInput = document.getElementById('nomor');
        const buyerWaInput = document.getElementById('buyerWa');
        const orderBtn = document.getElementById('orderBtn');
        const chatBox = document.getElementById('chat-box');
        const qaInput = document.getElementById('qaInput');

        let productsData = {};
        let groupedProducts = {};
        let faqData = {};
        let selectedProductId = null;

        // --- Helpers ---
        const showLoading = () => loadingOverlay.style.display = 'flex';
        const hideLoading = () => loadingOverlay.style.display = 'none';
        const formatRupiah = (angka) => parseFloat(angka).toLocaleString('id-ID');
        const normalizePhoneNumber = (number) => {
            if (!number) return '';
            let numStr = number.replace(/[^0-9]/g, '');
            if (numStr.startsWith('0')) numStr = '62' + numStr.slice(1);
            return numStr;
        };
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = `<i class="fas fa-check"></i> Tersalin`;
                setTimeout(() => { button.innerHTML = originalHTML; }, 2000);
            });
        }

        // --- Product Selection ---
        db.ref('products').on('value', (snapshot) => {
            const products = snapshot.val() |

| {};
            productsData = products;
            groupedProducts = {};
            Object.keys(products).forEach(id => {
                const product = { id,...products[id] };
                if (!groupedProducts[product.category]) groupedProducts[product.category] =;
                groupedProducts[product.category].push(product);
            });
            categorySelect.innerHTML = '<option value="" disabled selected>--- Pilih Kategori ---</option>';
            Object.keys(groupedProducts).sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        });

        categorySelect.addEventListener('change', (e) => {
            const category = e.target.value;
            if (!category) return;
            const categoryProducts = groupedProducts[category].sort((a, b) => a.name.localeCompare(b.name));
            let productsHtml = categoryProducts.map(p => `
                <div class="product-item p-3 flex justify-between items-center cursor-pointer" onclick="selectProduct('${p.id}')">
                    <span class="name font-medium">${p.name}</span>
                    <span class="price font-bold">Rp${formatRupiah(p.price)}</span>
                </div>`).join('');
            productVariantsAccordionDiv.innerHTML = `<div class="accordion-item rounded-lg mt-2"><div class="accordion-content p-2">${productsHtml}</div></div>`;
            productVariantsContainer.style.display = 'block';
        });

        function selectProduct(productId) {
            selectedProductId = productId;
            const product = productsData[productId];
            productNameInput.value = product.name;
            hargaInput.value = `Rp${formatRupiah(product.price)}`;
            document.querySelectorAll('.product-item').forEach(item => item.classList.remove('selected'));
            document.querySelector(`[onclick="selectProduct('${productId}')"]`).classList.add('selected');
           .forEach(el => {
                el.disabled = false;
                el.placeholder = `Masukkan data...`;
            });
        }

        // --- Order Submission ---
        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!selectedProductId) { alert('Pilih produk terlebih dahulu.'); return; }
            showLoading();
            const product = productsData[selectedProductId];
            const orderId = 'P' + Date.now().toString().slice(-6) + Math.floor(Math.random() * 100);
            const orderData = {
                id: orderId,
                productName: product.name,
                productId: selectedProductId,
                harga: product.price,
                buyerName: buyerNameInput.value.trim(),
                nomor: nomorInput.value.trim(),
                buyerWa: normalizePhoneNumber(buyerWaInput.value.trim()),
                timestamp: new Date().toISOString(),
                status: 'Belum Bayar'
            };
            try {
                await db.ref(`pesanan/${orderId}`).set(orderData);
                const waMessage = `🎉 Pesanan Baru Diterima! 🎉\n\nID: *${orderId}*\nProduk: *${product.name}*\nHarga: *Rp${formatRupiah(product.price)}*\nNama: *${orderData.buyerName}*\nNo/ID: *${orderData.nomor}*\nWA: ${orderData.buyerWa}\n\nStatus: *Belum Bayar*`;
                await sendWhatsAppNotification(ADMIN_WA_NUMBER, waMessage);
                alert(`Pesanan dengan ID ${orderId} berhasil dibuat! Mohon segera lakukan pembayaran.`);
                orderForm.reset();
                productNameInput.value = '';
                hargaInput.value = '';
                selectedProductId = null;
                document.querySelectorAll('.product-item.selected').forEach(i => i.classList.remove('selected'));
               .forEach(el => { el.disabled = true; el.placeholder = 'Pilih produk terlebih dahulu'; });
            } catch (error) {
                console.error("Error:", error);
                alert('Gagal membuat pesanan.');
            } finally {
                hideLoading();
            }
        });

        // --- Other Functions ---
        function checkOrderStatus() {
            const orderId = document.getElementById('orderIdCheck').value.trim();
            if (orderId) window.location.href = `./status.html?id=${orderId}`;
            else alert('Masukkan ID Pesanan.');
        }

        db.ref('faq').on('value', (snapshot) => {
            faqData = snapshot.val() |

| {};
            addMessageToChat("Halo! Ada yang bisa saya bantu?", "bot");
        });

        function addMessageToChat(message, sender) {
            const div = document.createElement('div');
            div.className = `chat-message ${sender} p-3 rounded-lg`;
            div.innerHTML = message;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function sendQuestion() {
            const question = qaInput.value.trim();
            if (!question) return;
            addMessageToChat(question, "user");
            qaInput.value = "";
            const lowerQ = question.toLowerCase();
            let answer = "Maaf, saya tidak menemukan jawaban yang cocok. Silakan hubungi admin.";
            for (const key in faqData) {
                if (faqData[key].question.toLowerCase().includes(lowerQ) |

| lowerQ.includes(faqData[key].question.toLowerCase())) {
                    answer = faqData[key].answer;
                    break;
                }
            }
            setTimeout(() => addMessageToChat(answer, "bot"), 500);
        }
        qaInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendQuestion(); });
        
        async function sendWhatsAppNotification(to, message) {
            const formData = new FormData();
            formData.append('appkey', NGIRIMWA_APPKEY);
            formData.append('authkey', NGIRIMWA_AUTHKEY);
            formData.append('to', to);
            formData.append('message', message);
            try {
                await fetch('https://ngirimwa.com/api/send-message', { method: 'POST', body: formData });
            } catch (error) { console.error('WA Error:', error); }
        }

        db.ref('dynamicContent').orderByChild('order').on('value', (snapshot) => {
            const area = document.getElementById('dynamic-content-area');
            area.innerHTML = '';
            snapshot.forEach(childSnapshot => {
                const content = childSnapshot.val();
                const section = document.createElement('div');
                section.className = 'section-card p-6 rounded-xl mb-6';
                if (content.html) section.innerHTML = content.html;
                if (content.css) {
                    const style = document.createElement('style');
                    style.textContent = content.css;
                    document.head.appendChild(style);
                }
                if (content.js) {
                    const script = document.createElement('script');
                    script.textContent = content.js;
                    document.body.appendChild(script);
                }
                area.appendChild(section);
            });
        });

        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme') |

| 'light';
            const next = current === 'light'? 'dark' : 'light';
            body.setAttribute('data-theme', next);
            document.getElementById('themeToggle').textContent = next === 'light'? '🌙' : '☀️';
            localStorage.setItem('theme', next);
        }
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') |

| 'light';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'light'? '🌙' : '☀️';
        });
    </script>
</body>
</html>
