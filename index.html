<!DOCTYPE html>  
<html lang="id">  
<head>  
  <meta charset="UTF-8" />  
  <title>Asdar Store Digital</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <style>  
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; background: #f9f9f9; }  
    h1, h2 { color: #2c3e50; }  
    label { font-weight: bold; margin-top: 10px; display: block; }  
    input, select, button { width: 100%; padding: 10px; margin: 8px 0; }  
    .info { background: #e7f3ff; padding: 10px; border-left: 4px solid #2196f3; }  
    #hasil, #hasilCariId { margin-top: 20px; }  
  </style>  
</head>  
<body>  
  
  <h1>Asdar Store Digital</h1>  
  
  <form id="formPesanan">  
    <label for="nama">Nama Lengkap</label>  
    <input type="text" id="nama" required />  
  
    <label for="nomor">Nomor HP / ID SN</label>  
    <input type="text" id="nomor" required />  
  
    <label for="kategori">Kategori Produk</label>  
    <select id="kategori" required>  
      <option value="">Pilih Kategori</option>  
    </select>  
  
    <label for="produk">Produk</label>  
    <select id="produk" required>  
      <option value="">Pilih Produk</option>  
    </select>  
  
    <div class="info" id="infoProduk">Harga dan deskripsi akan muncul di sini...</div>  
  
    <button type="submit">Pesan Sekarang</button>  
  </form>  
  
  <div id="hasil"></div>  
  
  <hr><br>  
  
  <h2>Cek Status Pesanan</h2>  
  <form onsubmit="event.preventDefault(); cekStatus();">  
    <input type="text" id="idCek" placeholder="Masukkan ID Pesanan" required />  
    <button type="submit">Cek Status</button>  
  </form>  
  
  <hr><br>  
  
  <h2>Darurat: Cari ID Pesanan</h2>  
  <p>Jika lupa ID Pesanan, isi data berikut untuk cari ID:</p>  
  <form id="formCariId" onsubmit="event.preventDefault(); cariIdPesanan();">  
    <label for="namaCari">Nama Buyer</label>  
    <input type="text" id="namaCari" required />  
  
    <label for="kategoriCari">Kategori Produk</label>  
    <select id="kategoriCari" required>  
      <option value="">Pilih Kategori</option>  
    </select>  
  
    <label for="produkCari">Produk</label>  
    <select id="produkCari" required>  
      <option value="">Pilih Produk</option>  
    </select>  
  
    <button type="submit">Cari ID Pesanan</button>  
  </form>  
  
  <div id="hasilCariId"></div>  
  
  <!-- Firebase SDK -->  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>  
  <script>  
    // Firebase Config  
    const firebaseConfig = {  
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",  
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",  
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",  
      projectId: "asdarstoredigitalll-d89c4",  
      storageBucket: "asdarstoredigitalll.appspot.com",  
      messagingSenderId: "220670500351",  
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"  
    };  
    firebase.initializeApp(firebaseConfig);  
    const db = firebase.database();  
  
    // Elemen HTML  
    const kategoriSelect = document.getElementById('kategori');  
    const produkSelect = document.getElementById('produk');  
    const infoProduk = document.getElementById('infoProduk');  
    const hasil = document.getElementById('hasil');  
  
    // Form Cari ID elements  
    const kategoriCari = document.getElementById('kategoriCari');  
    const produkCari = document.getElementById('produkCari');  
    const hasilCariId = document.getElementById('hasilCariId');  
  
    // Ambil kategori dari Firebase untuk kedua form  
    const produkRef = db.ref('produk');  
    produkRef.once('value').then(snapshot => {  
      const data = snapshot.val();  
      for (let kategori in data) {  
        const opt1 = document.createElement('option');  
        opt1.value = kategori;  
        opt1.textContent = kategori;  
        kategoriSelect.appendChild(opt1);  
  
        const opt2 = document.createElement('option');  
        opt2.value = kategori;  
        opt2.textContent = kategori;  
        kategoriCari.appendChild(opt2);  
      }  
    });  
  
    // Produk dropdown formPesanan  
    kategoriSelect.addEventListener('change', () => {  
      produkSelect.innerHTML = '<option value="">Pilih Produk</option>';  
      infoProduk.innerHTML = 'Harga dan deskripsi akan muncul di sini...';  
  
      const kategori = kategoriSelect.value;  
      if (!kategori) return;  
  
      produkRef.child(kategori).once('value').then(snapshot => {  
        const data = snapshot.val();  
        for (let nama in data) {  
          const opt = document.createElement('option');  
          opt.value = nama;  
          opt.textContent = nama;  
          produkSelect.appendChild(opt);  
        }  
      });  
    });  
  
    // Produk dropdown formCariId  
    kategoriCari.addEventListener('change', () => {  
      produkCari.innerHTML = '<option value="">Pilih Produk</option>';  
  
      const kategori = kategoriCari.value;  
      if (!kategori) return;  
  
      produkRef.child(kategori).once('value').then(snapshot => {  
        const data = snapshot.val();  
        for (let nama in data) {  
          const opt = document.createElement('option');  
          opt.value = nama;  
          opt.textContent = nama;  
          produkCari.appendChild(opt);  
        }  
      });  
    });  
  
    // Tampilkan info produk saat pilih produk di formPesanan  
    produkSelect.addEventListener('change', () => {  
      const kategori = kategoriSelect.value;  
      const produk = produkSelect.value;  
      if (!produk) return;  
  
      produkRef.child(`${kategori}/${produk}`).once('value').then(snapshot => {  
        const data = snapshot.val();  
        infoProduk.innerHTML = `  
          <b>Harga:</b> Rp${data.harga}<br>  
          <b>Deskripsi:</b> ${data.deskripsi || data.cara}  
        `;  
      });  
    });  
  
    // Submit Pesanan  
    document.getElementById('formPesanan').addEventListener('submit', e => {  
      e.preventDefault();  
  
      const nama = document.getElementById('nama').value.trim();  
      const nomor = document.getElementById('nomor').value.trim();  
      const kategori = kategoriSelect.value;  
      const produk = produkSelect.value;  
      const waktu = new Date().toISOString();  
      const id = "P" + Date.now();  
  
      if (!nama || !nomor || !kategori || !produk) {  
        alert("Harap lengkapi semua field!");  
        return;  
      }  
  
      db.ref('pesanan/' + id).set({  
        nama,  
        nomor,  
        kategori,  
        produk,  
        waktu,  
        status: 'Belum Bayar'  
      }).then(() => {  
        hasil.innerHTML = `  
          ‚úÖ Pesanan berhasil dibuat!<br/>  
          <b>ID Pesanan:</b> ${id}<br/>  
          üí≥ Silakan transfer ke:<br/>  
          - DANA: <b>087755432880</b><br/>  
          - ShopeePay: <b>081803004607</b><br/><br/>  
          üì§ Setelah transfer, upload bukti bayar di:   
          <a href="upload.html?id=${id}">Upload Bukti Bayar</a><br/><br/>  
          üîç Cek status di <a href="status.html?id=${id}">Halaman Status</a>  
        `;  
        document.getElementById('formPesanan').reset();  
        infoProduk.innerHTML = 'Harga dan deskripsi akan muncul di sini...';  
      });  
    });  
  
    // Cek Status Pesanan  
    function cekStatus() {  
      const id = document.getElementById('idCek').value.trim();  
      if (!id) return;  
      window.location.href = `status.html?id=${id}`;  
    }  
  
    // Cari ID Pesanan berdasarkan nama, kategori, produk  
    function cariIdPesanan() {  
      const namaCari = document.getElementById('namaCari').value.trim().toLowerCase();  
      const kategoriVal = kategoriCari.value;  
      const produkVal = produkCari.value;  
  
      if (!namaCari || !kategoriVal || !produkVal) {  
        alert("Harap isi semua field pencarian!");  
        return;  
      }  
  
      hasilCariId.innerHTML = "Mencari...";  
  
      db.ref('pesanan').once('value').then(snapshot => {  
        const data = snapshot.val() || {};  
        const hasilCari = [];  
  
        for (let id in data) {  
          const p = data[id];  
          if (!p) continue;  
  
          // Cocokkan nama, kategori, produk (case insensitive)  
          if (p.nama.toLowerCase() === namaCari && p.kategori === kategoriVal && p.produk === produkVal) {  
            hasilCari.push({ id, ...p });  
          }  
        }  
  
        if (hasilCari.length === 0) {  
          hasilCariId.innerHTML = "<b>Tidak ditemukan pesanan dengan data tersebut.</b>";  
        } else {  
          let html = "<b>ID Pesanan ditemukan:</b><br><ul>";  
          hasilCari.forEach(item => {  
            html += `<li><b>${item.id}</b> - Nama: ${item.nama}, Produk: ${item.kategori} > ${item.produk}</li>`;  
          });  
          html += "</ul>";  
          hasilCariId.innerHTML = html;  
        }  
      });  
    }  
  </script>  
</body>  
</html>
