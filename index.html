<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Asdar Store Digital</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, input, textarea { display: block; margin-bottom: 10px; padding: 8px; width: 100%; }
  </style>
</head>
<body>
  <h2>Pesan Produk</h2>

  <select id="pilihKategori">
    <option value="">Pilih Kategori</option>
  </select>

  <select id="pilihProduk" disabled>
    <option value="">Pilih Produk</option>
  </select>

  <input type="text" id="harga" placeholder="Harga" readonly />
  <textarea id="keterangan" placeholder="Keterangan Produk" rows="3" readonly></textarea>

  <input type="text" id="nama" placeholder="Nama Anda" required />
  <input type="text" id="nomor" placeholder="Nomor HP/ID SN" required />

  <button onclick="pesanSekarang()">Pesan Sekarang</button>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let semuaProduk = {};

    const pilihKategori = document.getElementById('pilihKategori');
    const pilihProduk = document.getElementById('pilihProduk');
    const hargaInput = document.getElementById('harga');
    const ketInput = document.getElementById('keterangan');

    db.ref('produk').once('value').then(snapshot => {
      semuaProduk = snapshot.val();
      const kategoriUnik = [...new Set(Object.values(semuaProduk).map(p => p.kategori))];
      kategoriUnik.forEach(kat => {
        const opt = document.createElement('option');
        opt.value = kat;
        opt.textContent = kat;
        pilihKategori.appendChild(opt);
      });
    });

    pilihKategori.addEventListener('change', () => {
      const kategoriDipilih = pilihKategori.value;
      pilihProduk.innerHTML = '<option value="">Pilih Produk</option>';
      if (!kategoriDipilih) {
        pilihProduk.disabled = true;
        return;
      }
      pilihProduk.disabled = false;
      Object.entries(semuaProduk).forEach(([id, p]) => {
        if (p.kategori === kategoriDipilih) {
          const opt = document.createElement('option');
          opt.value = id;
          opt.textContent = p.nama;
          pilihProduk.appendChild(opt);
        }
      });
    });

    pilihProduk.addEventListener('change', () => {
      const id = pilihProduk.value;
      if (!id || !semuaProduk[id]) return;
      const p = semuaProduk[id];
      hargaInput.value = 'Rp ' + p.harga.toLocaleString();
      ketInput.value = p.keterangan || '-';
    });

    function pesanSekarang() {
      const idProduk = pilihProduk.value;
      const nama = document.getElementById('nama').value;
      const nomor = document.getElementById('nomor').value;

      if (!idProduk || !nama || !nomor) {
        alert('Lengkapi semua isian.');
        return;
      }

      const produk = semuaProduk[idProduk];

      const idPesanan = Date.now();
      db.ref('pesanan/' + idPesanan).set({
        nama,
        nomor,
        produk: produk.nama,
        kategori: produk.kategori,
        harga: produk.harga,
        waktu: new Date().toLocaleString(),
        status: 'Belum Bayar'
      }).then(() => {
        alert('âœ… Pesanan disimpan. Lanjutkan dengan upload bukti bayar.');
        window.location.href = 'upload.html?id=' + idPesanan;
      });
    }
  </script>
</body>
</html>
