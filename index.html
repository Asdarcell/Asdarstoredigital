<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asdar Store Digital PRO</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif;}
    body {background: #f4f4f4; padding: 20px; color: #333;}
    h1 {text-align: center; margin-bottom: 20px;}
    form, .testimoni, .galeri, .dashboard {background: #fff; padding: 20px; margin-bottom: 30px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    input, select, textarea {width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px;}
    button {padding: 10px 20px; background: #007bff; border: none; color: white; border-radius: 5px; cursor: pointer;}
    button:hover {background: #0056b3;}
    .testi-item, .galeri-item {margin-bottom: 15px;}
    .bintang {color: gold;}
    .gambar-preview {max-width: 100%; margin-top: 10px; border-radius: 8px;}
  </style>
</head>
<body>

<h1>üõí Asdar Store Digital PRO</h1>

<!-- ‚úÖ FORM PEMESANAN -->
<form id="formPemesanan">
  <h2>Form Pemesanan</h2>
  <input type="text" id="nama" placeholder="Nama Pemesan" required />
  <select id="produk" required>
    <option value="">-- Pilih Produk --</option>
    <option value="K-Vision|Cling 1 Bulan|30000">K-Vision - Cling 1 Bulan - 30.000</option>
    <option value="Nex Parabola|Basic 30 Hari|35000">Nex Parabola - Basic 30 Hari - 35.000</option>
    <option value="XL|Unlimited TikTok|80000">XL - Unlimited TikTok - 80.000</option>
  </select>
  <input type="number" id="nominal" placeholder="Nominal Produk" readonly />
  <input type="number" id="total" placeholder="Total Bayar + 3000 admin" readonly />
  <input type="file" id="buktiBayar" accept="image/*" />
  <img id="previewGambar" class="gambar-preview" />
  <button type="submit">Sudah Bayar & Kirim ke WhatsApp</button>
</form>

<!-- ‚úÖ TESTIMONI -->
<div class="testimoni">
  <h2>Testimoni Pelanggan ‚≠ê</h2>
  <div id="listTestimoni"></div>

  <form onsubmit="kirimTestimoni(event)">
    <input type="text" id="namaTesti" placeholder="Nama Anda" required />
    <textarea id="isiTesti" placeholder="Tulis testimoni..." required></textarea>
    <select id="bintang">
      <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
      <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
      <option value="3">‚≠ê‚≠ê‚≠ê</option>
      <option value="2">‚≠ê‚≠ê</option>
      <option value="1">‚≠ê</option>
    </select>
    <button type="submit">Kirim Testimoni</button>
  </form>
</div>

<!-- ‚úÖ GALERI BUKTI BAYAR -->
<div class="galeri">
  <h2>üñº Galeri Bukti Bayar</h2>
  <div id="galeriBukti"></div>
</div>

<!-- ‚úÖ DASHBOARD ADMIN -->
<div class="dashboard">
  <h2>üë®‚Äçüíª Admin Dashboard</h2>
  <div id="listPesanan"></div>
</div>

<script type="module">
  // ‚úÖ KONFIGURASI FIREBASE
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
    authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
    projectId: "asdarstoredigitalll-d89c4",
    storageBucket: "asdarstoredigitalll.firebaseapp.com",
    messagingSenderId: "220670500351",
    appId: "1:220670500351:web:5737ae5958a6f5a67d5bca",
    measurementId: "G-CMRW37J19G",
    databaseURL: "https://asdarstoredigitalll-d89c4-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ‚úÖ LOGIKA PEMESANAN
  const form = document.getElementById('formPemesanan');
  const produk = document.getElementById('produk');
  const nominal = document.getElementById('nominal');
  const total = document.getElementById('total');
  const buktiBayar = document.getElementById('buktiBayar');
  const previewGambar = document.getElementById('previewGambar');

  produk.addEventListener('change', () => {
    const harga = produk.value.split('|')[2];
    nominal.value = harga;
    total.value = parseInt(harga) + 3000;
  });

  buktiBayar.addEventListener('change', () => {
    const file = buktiBayar.files[0];
    const reader = new FileReader();
    reader.onload = () => previewGambar.src = reader.result;
    reader.readAsDataURL(file);
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('nama').value;
    const produkVal = produk.value;
    const bukti = previewGambar.src;
    const data = {
      nama, produk: produkVal, bukti,
      waktu: new Date().toLocaleString()
    };
    push(ref(db, 'pesanan'), data);
    alert("Berhasil dikirim ke admin via WhatsApp!");
    const msg = `Halo Admin, saya *${nama}* telah memesan:\nProduk: ${produkVal}\nTotal: Rp${total.value}\nSilakan cek bukti bayar.`;
    window.open(`https://wa.me/6281803004607?text=${encodeURIComponent(msg)}`);
  });

  // ‚úÖ TESTIMONI
  const testimoniNegatif = ["jelek", "penipu", "gagal", "buruk", "bohong"];
  const kirimTestimoni = e => {
    e.preventDefault();
    const nama = document.getElementById('namaTesti').value;
    const isi = document.getElementById('isiTesti').value;
    const bintang = document.getElementById('bintang').value;
    if (testimoniNegatif.some(kata => isi.toLowerCase().includes(kata))) {
      alert("Testimoni mengandung kata negatif dan ditolak.");
      return;
    }
    const data = { nama, isi, bintang, waktu: new Date().toLocaleString() };
    push(ref(db, 'testimoni'), data);
  };

  // ‚úÖ TAMPILKAN TESTIMONI + TESTI BUATAN
  const listTestimoni = document.getElementById('listTestimoni');
  const testiBuatan = [
    {nama:"Rina", isi:"Top markotop!", bintang:"5"},
    {nama:"Budi", isi:"Voucher aktif cepat!", bintang:"5"},
    {nama:"Dewi", isi:"Admin ramah, mantap!", bintang:"4"},
  ];
  testiBuatan.forEach(t => {
    const el = document.createElement('div');
    el.innerHTML = `<b>${t.nama}</b> (${t.bintang}‚≠ê): ${t.isi}`;
    listTestimoni.appendChild(el);
  });

  onValue(ref(db, 'testimoni'), snapshot => {
    listTestimoni.innerHTML = '';
    testiBuatan.forEach(t => {
      const el = document.createElement('div');
      el.innerHTML = `<b>${t.nama}</b> (${t.bintang}‚≠ê): ${t.isi}`;
      listTestimoni.appendChild(el);
    });
    snapshot.forEach(data => {
      const val = data.val();
      const el = document.createElement('div');
      el.innerHTML = `<b>${val.nama}</b> (${val.bintang}‚≠ê): ${val.isi}`;
      listTestimoni.prepend(el);
    });
  });

  // ‚úÖ TAMPILKAN GALERI BUKTI
  onValue(ref(db, 'pesanan'), snapshot => {
    const galeri = document.getElementById('galeriBukti');
    galeri.innerHTML = '';
    snapshot.forEach(data => {
      const val = data.val();
      const el = document.createElement('div');
      el.className = 'galeri-item';
      el.innerHTML = `<b>${val.nama}</b><br><img src="${val.bukti}" width="200" />`;
      galeri.appendChild(el);
    });
  });

  // ‚úÖ ADMIN DASHBOARD (Hapus)
  onValue(ref(db, 'pesanan'), snapshot => {
    const list = document.getElementById('listPesanan');
    list.innerHTML = '';
    snapshot.forEach(data => {
      const val = data.val();
      const el = document.createElement('div');
      el.className = 'testi-item';
      el.innerHTML = `
        <b>${val.nama}</b> - ${val.produk} <br>
        <img src="${val.bukti}" width="150" /><br>
        <small>${val.waktu}</small><br>
        <button onclick="hapus('${data.key}')">Hapus</button>
      `;
      list.appendChild(el);
    });
  });

  window.hapus = (key) => {
    remove(ref(db, 'pesanan/' + key));
  };
</script>

</body>
</html>
