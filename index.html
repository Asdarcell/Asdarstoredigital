<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asdar Store Digital</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { display: block; margin: 10px 0; padding: 10px; width: 100%; }
    h2 { margin-top: 40px; }
    img { max-width: 100%; height: auto; margin-top: 10px; }
  </style>
</head>
<body>

  <h1>Asdar Store Digital</h1>

  <!-- FORM PESANAN -->
  <h2>Form Pemesanan</h2>
  <form id="orderForm">
    <input type="text" id="nama" placeholder="Nama Anda" required />
    <input type="text" id="nomor" placeholder="Nomor HP" required />
    <input type="text" id="produk" placeholder="Nama Produk" required />
    <input type="text" id="idProduk" placeholder="ID/SN/Nomor Tujuan" required />
    <button type="submit">Kirim Pesanan</button>
  </form>

  <!-- FORM UPLOAD -->
  <h2>Upload Bukti Bayar</h2>
  <form id="uploadForm">
    <input type="text" id="nomorUpload" placeholder="Nomor HP Anda" required />
    <input type="file" id="buktiBayar" accept="image/*" required />
    <button type="submit">Upload Bukti</button>
  </form>

  <!-- CEK STATUS -->
  <h2>Cek Status Pesanan</h2>
  <input type="text" id="nomorCek" placeholder="Masukkan Nomor HP" />
  <button onclick="cekStatus()">Cek</button>
  <div id="hasilStatus"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
      authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
      projectId: "asdarstoredigitalll-d89c4",
      storageBucket: "asdarstoredigitalll-d89c4.appspot.com",
      messagingSenderId: "220670500351",
      appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();
  </script>

  <!-- Script Logika Pembeli -->
  <script>
    // Kirim Pesanan
    document.getElementById("orderForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const nama = document.getElementById("nama").value;
      const nomor = document.getElementById("nomor").value;
      const produk = document.getElementById("produk").value;
      const idProduk = document.getElementById("idProduk").value;

      const id = Date.now();
      db.ref("pesanan/" + id).set({
        nama, nomor, produk, idProduk,
        status: "Menunggu Verifikasi"
      }).then(() => {
        alert("Pesanan terkirim!");
        this.reset();
      });
    });

    // Upload Bukti Bayar
    document.getElementById("uploadForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const nomor = document.getElementById("nomorUpload").value;
      const file = document.getElementById("buktiBayar").files[0];

      const ref = storage.ref("bukti_bayar/" + nomor + "_" + Date.now());
      ref.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        // Cari pesanan dengan nomor HP dan update bukti bayar
        db.ref("pesanan").orderByChild("nomor").equalTo(nomor).once("value", snap => {
          snap.forEach(s => {
            db.ref("pesanan/" + s.key).update({ bukti_bayar: url });
          });
        });
        alert("Bukti bayar berhasil diupload!");
        this.reset();
      });
    });

    // Cek Status Pesanan
    function cekStatus() {
      const nomor = document.getElementById("nomorCek").value;
      const hasil = document.getElementById("hasilStatus");
      db.ref("pesanan").orderByChild("nomor").equalTo(nomor).once("value", snap => {
        if (snap.exists()) {
          hasil.innerHTML = '';
          snap.forEach(data => {
            const p = data.val();
            hasil.innerHTML += `
              <p><strong>${p.produk}</strong><br>
              Status: ${p.status}<br>
              ${p.bukti_selesai ? `<img src=\"${p.bukti_selesai}\" />` : ''}</p><hr>`;
          });
        } else {
          hasil.innerHTML = 'Pesanan tidak ditemukan.';
        }
      });
    }
  </script>
</body>
</html>
