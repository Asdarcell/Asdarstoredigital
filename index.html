<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asdar Store Digital</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <style>
    body { background: #f9f9f9; font-family: 'Poppins', sans-serif; padding: 20px; }
    header { background: #3498db; color: white; padding: 15px; text-align: center; margin-bottom: 20px; border-radius: 8px; }
    .card { margin-bottom: 15px; }
  </style>
</head>
<body>
  <header><h1 id="banner">Asdar Store</h1></header>  <div class="container">
    <p id="note" class="alert alert-info"></p><div id="produkList" class="row"></div>

<div id="formPesan" class="mt-4">
  <h3>Pesan Produk</h3>
  <form id="pesanForm">
    <input type="text" id="nama" class="form-control mb-2" placeholder="Nama Lengkap" required />
    <input type="text" id="nomor" class="form-control mb-2" placeholder="Nomor HP / ID SN" required />
    <select id="produkSelect" class="form-select mb-2" required><option value="">Pilih Produk</option></select>
    <button type="submit" class="btn btn-success">Pesan Sekarang</button>
  </form>
  <div id="hasil" class="mt-3"></div>
</div>

<div id="cekStatusBox" class="mt-4" style="display: none;">
  <h4>Cek Status</h4>
  <form id="cekStatusForm">
    <input type="text" id="idCek" class="form-control mb-2" placeholder="Masukkan ID Pesanan" required />
    <button class="btn btn-primary">Cek Status</button>
  </form>
</div>

<div id="testimoniBox" class="mt-4" style="display: none;">
  <h4>Testimoni</h4>
  <div id="listTestimoni" class="border p-3 bg-light rounded">Memuat...</div>
</div>

  </div>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>  <script>
    window.addEventListener('DOMContentLoaded', function () {
      const firebaseConfig = {
        apiKey: "AIzaSyA_L6U3HKM1DnKuq_Q1zKFH4bk8GMAz210",
        authDomain: "asdarstoredigitalll-d89c4.firebaseapp.com",
        databaseURL: "https://asdarstoredigitalll-default-rtdb.firebaseio.com",
        projectId: "asdarstoredigitalll-d89c4",
        storageBucket: "asdarstoredigitalll.appspot.com",
        messagingSenderId: "220670500351",
        appId: "1:220670500351:web:5737ae5958a6f5a67d5bca"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const produkList = document.getElementById("produkList");
      const produkSelect = document.getElementById("produkSelect");
      const hasil = document.getElementById("hasil");

      function loadKonten() {
        db.ref("halaman").once("value").then(snap => {
          const d = snap.val() || {};
          document.getElementById("banner").innerText = d.banner || "Asdar Store";
          document.getElementById("note").innerText = d.note || "";
        });
      }

      function loadProduk() {
        db.ref("produk").once("value").then(snap => {
          const data = snap.val() || {};
          produkList.innerHTML = "";
          produkSelect.innerHTML = '<option value="">Pilih Produk</option>';
          for (let kat in data) {
            for (let nama in data[kat]) {
              const p = data[kat][nama];
              if (!p.aktif) continue;
              const id = `${kat}|||${nama}`;
              const card = `<div class="col-md-6">
                <div class="card p-3">
                  <b>${kat} > ${nama}</b><br/>
                  Rp${p.harga}<br/>
                  <small>${p.deskripsi || p.cara}</small>
                </div>
              </div>`;
              produkList.innerHTML += card;
              produkSelect.innerHTML += `<option value="${id}">${kat} > ${nama}</option>`;
            }
          }
        });
      }

      document.getElementById("pesanForm").addEventListener("submit", e => {
        e.preventDefault();
        const nama = document.getElementById("nama").value.trim();
        const nomor = document.getElementById("nomor").value.trim();
        const val = produkSelect.value;
        if (!val) return alert("Pilih produk terlebih dahulu");
        const [kat, namaProduk] = val.split("|||");
        db.ref(`produk/${kat}/${namaProduk}`).once("value").then(snap => {
          const p = snap.val();
          const id = "P" + Date.now();
          const data = {
            nama, nomor, kategori: kat, produk: namaProduk,
            harga: p.harga || 0,
            waktu: new Date().toISOString(),
            status: "Belum Bayar"
          };
          db.ref("pesanan/" + id).set(data).then(() => {
            hasil.innerHTML = `✅ Berhasil pesan! ID: <b>${id}</b>`;
            document.getElementById("pesanForm").reset();
          });
        });
      });

      document.getElementById("cekStatusForm").addEventListener("submit", e => {
        e.preventDefault();
        const id = document.getElementById("idCek").value.trim();
        if (id) window.location.href = `status.html?id=${id}`;
      });

      function loadFitur() {
        db.ref("fitur").once("value").then(snap => {
          const d = snap.val() || {};
          if (d.showCekStatus) document.getElementById("cekStatusBox").style.display = "block";
          if (d.showTestimoni) {
            document.getElementById("testimoniBox").style.display = "block";
            db.ref("testimoni").once("value").then(snap => {
              const list = document.getElementById("listTestimoni");
              const data = Object.values(snap.val() || {}).reverse();
              list.innerHTML = data.map(t => `⭐️⭐️⭐️⭐️⭐️<br/><b>${t.nama}</b>: ${t.pesan}`).join("<hr>");
            });
          }
        });
      }

      loadKonten();
      loadProduk();
      loadFitur();
    });
  </script></body>
</html>
